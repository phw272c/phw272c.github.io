<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Week 4 - Analysis of spatial clustering | Applied Spatial Data Science for Public Health</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Week 4 - Analysis of spatial clustering" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Aim" />
<meta property="og:description" content="Aim" />
<link rel="canonical" href="http://localhost:4000/week-4/" />
<meta property="og:url" content="http://localhost:4000/week-4/" />
<meta property="og:site_name" content="Applied Spatial Data Science for Public Health" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-02-25T00:00:00-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Week 4 - Analysis of spatial clustering" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-25T00:00:00-08:00","datePublished":"2022-02-25T00:00:00-08:00","description":"Aim","headline":"Week 4 - Analysis of spatial clustering","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/week-4/"},"url":"http://localhost:4000/week-4/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Applied Spatial Data Science for Public Health" /></head>
<body>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Week 4 - Analysis of spatial clustering</h1>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="aim">Aim</h3>

<p>To introduce methods for exploring clustering in spatial data</p>

<h3 id="content">Content</h3>

<p>This post provides an introduction to methods for exploring clustering
in different types of spatial data. The approaches will be explored
together in R, followed by an opportunity to adapt the code and run the
analysis yourself.</p>

<h3 id="datasets">Datasets</h3>

<ol>
  <li>Malaria point prevalence data at the village level from Burkina Faso</li>
  <li>Leukemia data at the census tract level from New York State</li>
  <li>Malaria case event data and population controls from northern
Namibia</li>
</ol>

<p>First we will attach the libraries used for visualization.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">spatstat</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">geoR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w"> 
</span><span class="n">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span><span class="w">  </span><span class="c1"># contains a function for logistic transformation (log odds) to make more normal</span><span class="w">
</span></code></pre></div></div>

<p>These libraries are for spatial data management and point process
analysis.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">

</span><span class="c1"># Moran's I and spatial dependencies</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">spdep</span><span class="p">)</span><span class="w"> </span><span class="c1"># Spatial Dependence: Weighting Schemes, Statistics and Models</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ape</span><span class="p">)</span><span class="w"> </span><span class="c1"># Analyses of Phylogenetics and Evolution</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pgirmess</span><span class="p">)</span><span class="w"> </span><span class="c1"># Data Analysis in Ecology</span><span class="w">

</span><span class="c1"># Libraries for point processes</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">spatstat</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">splancs</span><span class="p">)</span><span class="w"> </span><span class="c1"># K-function</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">smacpod</span><span class="p">)</span><span class="w"> </span><span class="c1"># Spatial scanning statistic</span><span class="w">
</span></code></pre></div></div>

<p>We’re going to load in some malaria data from Burkina Faso and visualize
it using Leaflet to see if we can initially assess if there may be
evidence of spatial clustering. What do you think?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Open BF malaria data</span><span class="w">
</span><span class="n">BF_malaria_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/phw272c/phw272c.github.io/master/data/BF_malaria_data.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">BF_Adm_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="s2">"GADM"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s2">"BFA"</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">proj4string</span><span class="p">(</span><span class="n">BF_Adm_1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s1">'+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 '</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning in proj4string(obj): CRS object has comment, which is lost in output; in tests, see
## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate prevalence</span><span class="w">
</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">prevalence</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">positives</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">examined</span><span class="w">

</span><span class="c1"># What do the data look like - do you see evidence of spatial clustering?</span><span class="w">
</span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="s2">"Oranges"</span><span class="p">,</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">prevalence</span><span class="p">)</span><span class="w">
</span><span class="n">leaflet</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="o">~</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
                                                             </span><span class="n">fillColor</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">pal</span><span class="p">(</span><span class="n">prevalence</span><span class="p">),</span><span class="w"> </span><span class="n">radius</span><span class="o">=~</span><span class="n">prevalence</span><span class="o">*</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">stroke</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pal</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">prevalence</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-4-1.png" alt="" /></p>

<h2 id="part-i-testing-for-spatial-autocorrelation-in-point-level-data">Part I: Testing for spatial autocorrelation in point-level data</h2>

<h3 id="global-spatial-autocorrelation">Global spatial autocorrelation</h3>

<p>In this section we’re going to look at some more formal statistical
tests of global spatial autocorrelation. We’ll look at two general ways
of doing this: using ‘Moran’s I’ and using correlograms. These can each
be done using multiple different packages in R.</p>

<p>Approach 1: Calculate Moran’s I using a distance based matrix</p>

<p>First we will look at the distribution of the prevalence data to see if
they are close to normally distributed. If the are very skewed, we will
need to transform them because the Moran’s I test produces a comparison
to the normal distribution. Here, we will use the logit transformation
to produce a more normal distribution. Then we will calculate the
distance between each of the points and use the inverse of the distance
matrix to produce a matrix of weights that we will use to calculate
Moran’s I.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">prevalence</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prevalence"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-5-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">logit</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">prevalence</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Log odds"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-5-2.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate a distance matrix</span><span class="w">
</span><span class="n">BF.dists</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">)))</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">BF.dists</span><span class="p">)</span><span class="w"> </span><span class="c1"># 109 x 109 matrix of distance between all sets of points</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 109 109
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Take the inverse of the matrix values so that closer values have a larger weight and vs vs</span><span class="w">
</span><span class="n">BF.dists.inv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">BF.dists</span><span class="w">
</span><span class="n">diag</span><span class="p">(</span><span class="n">BF.dists.inv</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">   </span><span class="c1"># replace the diagonal values with zero</span><span class="w">

</span><span class="c1"># Computes Moran's I autocorrelation coefficient of x giving a matrix of weights (here based on distance) </span><span class="w">
</span><span class="n">Moran.I</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">,</span><span class="w"> </span><span class="n">BF.dists.inv</span><span class="p">)</span><span class="w">                 </span><span class="c1"># from the "ape" package</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## $observed
## [1] 0.0666352
## 
## $expected
## [1] -0.009259259
## 
## $sd
## [1] 0.01639855
## 
## $p.value
## [1] 3.690017e-06
</code></pre></div></div>

<p>Approach 2: Create a correlogram to explore Moran’s I over different
spatial lags. The “pgirmess” package requires spdep (which also has
correlogram options) but is much simplier and user-friendly.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate the maximum distance between points</span><span class="w">
</span><span class="n">maxDist</span><span class="o">&lt;-</span><span class="nf">max</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">)))</span><span class="w">
</span><span class="n">maxDist</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 7.534414
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xy</span><span class="o">=</span><span class="n">cbind</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">)</span><span class="w">
</span><span class="n">pgi.cor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">correlog</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="o">=</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s2">"Moran"</span><span class="p">,</span><span class="w"> </span><span class="n">nbclass</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">   </span><span class="c1"># "pgirmess" package</span><span class="w">
</span><span class="c1"># coords = xy cordinates, z= vector of values at each location and nbclass = the number of bins</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pgi.cor</span><span class="p">)</span><span class="w"> </span><span class="c1"># statistically significant values (p&lt;0.05) are plotted in red</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-6-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pgi.cor</span><span class="w"> </span><span class="c1"># distclass is midpoint for the bin</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Moran I statistic 
##       dist.class        coef      p.value    n
##  [1,]  0.4121237  0.13669304 6.435709e-04 1092
##  [2,]  1.1618390  0.13700359 3.059924e-06 2176
##  [3,]  1.9115538  0.09009855 2.482029e-05 2680
##  [4,]  2.6612685 -0.02082828 6.589705e-01 2172
##  [5,]  3.4109833 -0.10323722 9.946353e-01 1376
##  [6,]  4.1606981 -0.16259353 9.997622e-01 1146
##  [7,]  4.9104129 -0.20629178 9.991684e-01  662
##  [8,]  5.6601277 -0.27492632 9.990240e-01  320
##  [9,]  6.4098425 -0.11874035 7.536360e-01  128
## [10,]  7.1595572 -0.25618534 7.320096e-01   20
</code></pre></div></div>

<p>Based on the correlogram, over what spatial lags are there evidence for
spatial autocorrelation? Is this clustering positive or negative?</p>

<p>Compare the correlogram to the results from a semivariogram approach:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BF_malaria_data_geo</span><span class="o">&lt;-</span><span class="n">as.geodata</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="s2">"latitude"</span><span class="p">,</span><span class="s2">"log_odds"</span><span class="p">)])</span><span class="w">

</span><span class="c1"># Generate and plot a binned variogram (10 bins) NB: have made for full max distance (even though likely inaccurate) for comparison</span><span class="w">
</span><span class="n">Vario</span><span class="o">&lt;-</span><span class="n">variog</span><span class="p">(</span><span class="n">BF_malaria_data_geo</span><span class="p">,</span><span class="n">max.dist</span><span class="o">=</span><span class="m">7.53</span><span class="p">,</span><span class="n">uvec</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0.4121237</span><span class="p">,</span><span class="m">7.1595572</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Vario</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pgi.cor</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-8-1.png" alt="" /></p>

<p>Approach 3: Calculate Moran’s I using a binary distance matrix. For this
approach, we are going to create sets of ‘neighbors’ based upon their
proximity. This approach can be used with point data but is especially
useful for areal data, as we will see shortly.</p>

<p>For this approach, you will need to consider what is a sensible distance
to classify points as neighbors. Considerations might include the scale
of analysis and the distribution of points. In the comparison of
different neighboring structures, you can see that increasing the
distance within which one is considered a neighbor dramatically
increases the overall number of neighbor linkages.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coords</span><span class="o">&lt;-</span><span class="n">coordinates</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span><span class="w"> </span><span class="c1"># set spatial coordinates to create a spatial object</span><span class="w">
</span><span class="n">IDs</span><span class="o">&lt;-</span><span class="n">row.names</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">coords</span><span class="p">))</span><span class="w">

</span><span class="c1"># In this approach, we chose a distance d such that pairs of points with distances less than </span><span class="w">
</span><span class="c1"># d are neighbors and those further apart are not. </span><span class="w">

</span><span class="n">Neigh_nb</span><span class="o">&lt;-</span><span class="n">knn2nb</span><span class="p">(</span><span class="n">knearneigh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">longlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="n">IDs</span><span class="p">)</span><span class="w">     </span><span class="c1"># using the "spdep" package</span><span class="w">
</span><span class="c1"># assigns at least one neighbor to each and calculates the distances between</span><span class="w">
</span><span class="n">dsts</span><span class="o">&lt;-</span><span class="n">unlist</span><span class="p">(</span><span class="n">nbdists</span><span class="p">(</span><span class="n">Neigh_nb</span><span class="p">,</span><span class="n">coords</span><span class="p">))</span><span class="w"> </span><span class="c1"># returns the distance between nearest neighbors for each point</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">dsts</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.03727 0.12693 0.19004 0.22742 0.27488 1.10524
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">max_1nn</span><span class="o">&lt;-</span><span class="nf">max</span><span class="p">(</span><span class="n">dsts</span><span class="p">)</span><span class="w">
</span><span class="n">max_1nn</span><span class="w"> </span><span class="c1"># maximum distance to provide at least one neighbor to each point</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 1.10524
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># We create different neighbor structures based upon distance</span><span class="w">
</span><span class="n">Neigh_kd1</span><span class="o">&lt;-</span><span class="n">dnearneigh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="n">d1</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="o">=</span><span class="n">max_1nn</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="n">IDs</span><span class="p">)</span><span class="w">   </span><span class="c1"># neighbors within maximum distance</span><span class="w">
</span><span class="n">Neigh_kd2</span><span class="o">&lt;-</span><span class="n">dnearneigh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="n">d1</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="o">=</span><span class="m">2</span><span class="o">*</span><span class="n">max_1nn</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="n">IDs</span><span class="p">)</span><span class="w"> </span><span class="c1"># neighbors within 2X maximum distance</span><span class="w">

</span><span class="n">nb_1</span><span class="o">&lt;-</span><span class="nf">list</span><span class="p">(</span><span class="n">d1</span><span class="o">=</span><span class="n">Neigh_kd1</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="o">=</span><span class="n">Neigh_kd2</span><span class="p">)</span><span class="w"> </span><span class="c1"># list of neighbor structures</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">nb_1</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">is.symmetric.nb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="o">=</span><span class="nb">T</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##   d1   d2 
## TRUE TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Checks for symmetry (i.e. if i is a neighbor of j, then j is a neighbor of i). Does not always hold for k-nearest neighbours</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">nb_1</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">n.comp.nb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">nc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## d1 d2 
##  1  1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Number of disjoint connected subgraphs</span><span class="w">

</span><span class="c1"># Plot neighbors comparing the two distances </span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Neigh_kd1</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Neigh_kd2</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-9-1.png" alt="" /></p>

<p>To run a spatial test for clustering, we need to assign weights to the
neighbor list. We will use the neighbor structure with all neighbors
within the maximum neighbor distance between any two points.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#assign weights; </span><span class="w">
</span><span class="n">weights</span><span class="o">&lt;-</span><span class="n">nb2listw</span><span class="p">(</span><span class="n">Neigh_kd1</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="s2">"W"</span><span class="p">)</span><span class="w">   </span><span class="c1"># row standardized binary weights, using minimum distance for one neighbor</span><span class="w">
</span><span class="n">weights</span><span class="w">                                   </span><span class="c1"># "B" is simplest binary weights</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 109 
## Number of nonzero links: 1914 
## Percentage nonzero weights: 16.10976 
## Average number of links: 17.55963 
## 
## Weights style: W 
## Weights constants summary:
##     n    nn  S0       S1       S2
## W 109 11881 109 16.44475 442.0046
</code></pre></div></div>

<p>Using this weights matrix, we can now run the Moran’s I test on the
logit transformed prevalence using the neighborhood matrix. How do the
results compare to other approaches?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">moran.test</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">listw</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span><span class="w">  </span><span class="c1">#using row standardised weights</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
##  Moran I test under randomisation
## 
## data:  BF_malaria_data$log_odds  
## weights: weights    
## 
## Moran I statistic standard deviate = 4.7332, p-value = 1.105e-06
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.154300895      -0.009259259       0.001194126
</code></pre></div></div>

<p>We can also use a simulation approach: we simulate the test statistic
using random permutations of BF_malaria_data$log_odds so that the
values are randomly assigned to locations and the statistic is computed
nsim times; we compare the observed statistic to the distribution. What
do you conclude about evidence for spatial autocorrelation?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">bperm</span><span class="o">&lt;-</span><span class="n">moran.mc</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">listw</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span><span class="n">nsim</span><span class="o">=</span><span class="m">999</span><span class="p">)</span><span class="w">
</span><span class="n">bperm</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
##  Monte-Carlo simulation of Moran I
## 
## data:  BF_malaria_data$log_odds 
## weights: weights  
## number of simulations + 1: 1000 
## 
## statistic = 0.1543, observed rank = 1000, p-value = 0.001
## alternative hypothesis: greater
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#statistic = 0.15, observed rank = 1000, p-value = 0.001</span><span class="w">

</span><span class="c1"># Plot simulated test statistics</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">bperm</span><span class="o">$</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Simulated Moran's I"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-12-1.png" alt="" /></p>

<p>We can now also take a look at running Moran’s I for areal data
(polygons), using a dataset on leukemia from New York (Turnbull et al
1990). We will also use these data later in the course in week 7.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nydata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgdal</span><span class="o">::</span><span class="n">readOGR</span><span class="p">(</span><span class="s2">"https://github.com/phw272c/phw272c.github.io/raw/master/data/nydata.geojson"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## OGR data source with driver: GeoJSON 
## Source: "https://github.com/phw272c/phw272c.github.io/raw/master/data/nydata.geojson", layer: "nydata"
## with 281 features
## It has 17 fields
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#lets take a look at the data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">nydata</span><span class="o">@</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##          AREANAME     AREAKEY        X        Y POP8 TRACTCAS  PROPCAS
## 0 Binghamton city 36007000100 4.069397 -67.3533 3540     3.08 0.000870
## 1 Binghamton city 36007000200 4.639371 -66.8619 3560     4.08 0.001146
## 2 Binghamton city 36007000300 5.709063 -66.9775 3739     1.09 0.000292
## 3 Binghamton city 36007000400 7.613831 -65.9958 2784     1.07 0.000384
## 4 Binghamton city 36007000500 7.315968 -67.3183 2571     3.06 0.001190
## 5 Binghamton city 36007000600 8.558753 -66.9344 2729     1.06 0.000388
##   PCTOWNHOME PCTAGE65P        Z  AVGIDIST PEXPOSURE   Cases       Xm       Ym
## 0  0.3277311 0.1466102  0.14197 0.2373852  3.167099 3.08284 4069.397 -67353.3
## 1  0.4268293 0.2351124  0.35555 0.2087413  3.038511 4.08331 4639.371 -66861.9
## 2  0.3377396 0.1380048 -0.58165 0.1708548  2.838229 1.08750 5709.063 -66977.5
## 3  0.4616048 0.1188937 -0.29634 0.1406045  2.643366 1.06515 7613.831 -65995.8
## 4  0.1924370 0.1415791  0.45689 0.1577753  2.758587 3.06017 7315.968 -67318.3
## 5  0.3651786 0.1410773 -0.28123 0.1726033  2.848411 1.06386 8558.753 -66934.4
##     Xshift  Yshift
## 0 423391.0 4661502
## 1 423961.0 4661993
## 2 425030.6 4661878
## 3 426935.4 4662859
## 4 426637.5 4661537
## 5 427880.3 4661921
</code></pre></div></div>

<p>For now, with this dataset we are only interested in seeing if there is
global clustering in the area-level case incidence. In the dataset we
find a ‘Cases’ variable that gives the estimated number of cases per
area. We need to also consider the population in each area however,
because areas with higher populations are more likely to have more cases
just due to population size. So we will first create an incidence
variable to normalize the case data by population size.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nydata</span><span class="o">$</span><span class="n">inc_per_1000</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">nydata</span><span class="o">$</span><span class="n">Cases</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">nydata</span><span class="o">$</span><span class="n">POP8</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span></code></pre></div></div>

<p>As these are areas and not points, we will not use distance to define
the neighbors, but rather which polygons are directly touching one
another along a boundary or boundary point.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sf</span><span class="o">::</span><span class="n">sf_use_s2</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="c1"># https://stackoverflow.com/questions/68478179/how-to-resolve-spherical-geometry-failures-when-joining-spatial-data</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Spherical geometry (s2) switched off
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Contiguity neighbors - all that share a boundary point</span><span class="w">
</span><span class="n">nydata_nb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">poly2nb</span><span class="p">(</span><span class="n">nydata</span><span class="p">)</span><span class="w">  </span><span class="c1">#queen contiguity</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning in st_is_longlat(pl): bounding box has potentially an invalid value
## range for longlat data

## Warning in st_is_longlat(pl): bounding box has potentially an invalid value
## range for longlat data

## Warning in st_is_longlat(x): bounding box has potentially an invalid value range
## for longlat data

## although coordinates are longitude/latitude, st_intersects assumes that they are planar
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nydata_nbr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">poly2nb</span><span class="p">(</span><span class="n">nydata</span><span class="p">,</span><span class="w"> </span><span class="n">queen</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">  </span><span class="c1">#rook contiguity</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Warning in st_is_longlat(pl): bounding box has potentially an invalid value
## range for longlat data

## Warning in st_is_longlat(pl): bounding box has potentially an invalid value
## range for longlat data

## Warning in st_is_longlat(x): bounding box has potentially an invalid value range
## for longlat data

## although coordinates are longitude/latitude, st_intersects assumes that they are planar
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#coordinates</span><span class="w">
</span><span class="n">coords_ny</span><span class="o">&lt;-</span><span class="n">coordinates</span><span class="p">(</span><span class="n">nydata</span><span class="p">)</span><span class="w">

</span><span class="c1">#view and compare the neighbors</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">nydata</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">nydata_nb</span><span class="p">,</span><span class="n">coords_ny</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">nydata</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">nydata_nbr</span><span class="p">,</span><span class="n">coords_ny</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-15-1.png" alt="" /></p>

<p>As above, we then set the weights for the neighbor matrix. The default
is row standardized (each row sums to one), or binary, where neighbors
are 1 and 0 otherwise.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##set weights - contiguity</span><span class="w">
</span><span class="c1">#weights style W - row standardized</span><span class="w">
</span><span class="n">nydata_w</span><span class="o">&lt;-</span><span class="n">nb2listw</span><span class="p">(</span><span class="n">nydata_nb</span><span class="p">)</span><span class="w">
</span><span class="n">nydata_w</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 281 
## Number of nonzero links: 1624 
## Percentage nonzero weights: 2.056712 
## Average number of links: 5.779359 
## 
## Weights style: W 
## Weights constants summary:
##     n    nn  S0       S1       S2
## W 281 78961 281 106.6125 1164.157
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#weights style B - binary</span><span class="w">
</span><span class="n">nydata_wB</span><span class="o">&lt;-</span><span class="n">nb2listw</span><span class="p">(</span><span class="n">nydata_nb</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s2">"B"</span><span class="p">)</span><span class="w">
</span><span class="n">nydata_wB</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 281 
## Number of nonzero links: 1624 
## Percentage nonzero weights: 2.056712 
## Average number of links: 5.779359 
## 
## Weights style: B 
## Weights constants summary:
##     n    nn   S0   S1    S2
## B 281 78961 1624 3248 41440
</code></pre></div></div>

<p>Based on this weights matrix, we can now do an initial check of spatial
autocorrelation in the data. What do you conclude? We will return to
this dataset in week 7.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##moran's tests of global spatial autocorrelation</span><span class="w">
</span><span class="n">moran.test</span><span class="p">(</span><span class="n">nydata</span><span class="o">$</span><span class="n">inc_per_1000</span><span class="p">,</span><span class="n">listw</span><span class="o">=</span><span class="n">nydata_w</span><span class="p">)</span><span class="w">  </span><span class="c1">#using row standardized</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
##  Moran I test under randomisation
## 
## data:  nydata$inc_per_1000  
## weights: nydata_w    
## 
## Moran I statistic standard deviate = 1.8649, p-value = 0.0311
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.060405798      -0.003571429       0.001176865
</code></pre></div></div>

<h3 id="local-spatial-autocorrelation">Local spatial autocorrelation</h3>

<p>The above approaches examined evidence for global spatial autorrelation.
Now we’re going to look at local measures of clustering. One way to do
this is using ‘Local Moran’s I’, which we will illustrate using the
point-level data from Burkina Faso.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First calculate the local Moran's I around each point based on the spatial weights object (binary based on at least one neighbor)</span><span class="w">
</span><span class="n">I</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">localmoran</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">,</span><span class="w"> </span><span class="n">weights</span><span class="p">)</span><span class="w">                         </span><span class="c1"># "spdep" package</span><span class="w">

</span><span class="c1"># Print 'LISA' for each point</span><span class="w">
</span><span class="n">Coef</span><span class="o">&lt;-</span><span class="n">printCoefmat</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">IDs</span><span class="p">,],</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="n">row.names</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span><span class="w">
                              </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##                 Ii        E.Ii      Var.Ii    Z.Ii Pr(z != E(Ii))    
##   [1,]  1.8125e-01 -7.7320e-03  2.0321e-01  0.4192      0.6750550    
##   [2,] -1.2819e-01 -7.9011e-04  1.6567e-02 -0.9898      0.3222658    
##   [3,]  1.7760e-01 -1.0791e-02  2.2400e-01  0.3980      0.6905976    
##   [4,]  1.6095e-01 -1.4860e-02  3.0721e-01  0.3172      0.7510925    
##   [5,]  1.4150e-01 -3.5181e-04  5.1692e-03  1.9730      0.0484971 *  
##   [6,] -9.3562e-01 -1.4721e-02  3.8417e-01 -1.4858      0.1373384    
##   [7,]  2.0481e-01 -3.1400e-03  3.1249e-02  1.1763      0.2394560    
##   [8,]  1.0326e-01 -3.9330e-04  3.9249e-03  1.6546      0.0980141 .  
##   [9,]  6.4866e-01 -4.1543e-02  3.9751e-01  1.0947      0.2736389    
##  [10,]  2.2870e-01 -3.6550e-03  4.0807e-02  1.1502      0.2500442    
##  [11,] -6.3207e-02 -8.4035e-04  1.7620e-02 -0.4698      0.6384687    
##  [12,]  5.2887e-02 -1.3459e-04  1.0018e-03  1.6752      0.0938957 .  
##  [13,] -3.1234e-02 -5.2641e-05  4.7285e-04 -1.4339      0.1515894    
##  [14,] -2.7457e-01 -3.2778e-03  2.9348e-02 -1.5836      0.1132854    
##  [15,]  1.8953e+00 -3.2990e-02  2.5998e-01  3.7819      0.0001556 ***
##  [16,]  3.7821e-01 -5.6326e-03  3.2807e-02  2.1192      0.0340724 *  
##  [17,] -7.7082e-02 -5.2710e-05  3.9237e-04 -3.8888      0.0001008 ***
##  [18,]  1.6616e-01 -2.7475e-03  1.6049e-02  1.3333      0.1824444    
##  [19,]  1.4622e-01 -2.3970e-03  1.6356e-02  1.1621      0.2452126    
##  [20,]  2.1928e-01 -4.6906e-03  2.5458e-02  1.4037      0.1603973    
##  [21,]  2.6115e+00 -4.3279e-02  4.6398e-01  3.8975       9.72e-05 ***
##  [22,]  6.0848e-01 -3.6628e-03  2.7167e-02  3.7139      0.0002041 ***
##  [23,]  1.4323e-01 -2.4940e-03  1.5713e-02  1.1625      0.2450275    
##  [24,]  2.7566e-03 -3.0994e-05  2.7841e-04  0.1671      0.8673174    
##  [25,] -2.7090e-01 -1.6415e-03  8.3470e-03 -2.9472      0.0032066 ** 
##  [26,]  2.1542e+00 -3.8421e-02  3.6883e-01  3.6104      0.0003057 ***
##  [27,]  1.6954e+00 -5.6051e-02  3.0991e-01  3.1460      0.0016550 ** 
##  [28,] -4.3038e-01 -2.1343e-03  1.3451e-02 -3.6925      0.0002221 ***
##  [29,] -4.5056e-01 -4.9503e-03  2.8853e-02 -2.6234      0.0087059 ** 
##  [30,]  2.4252e+00 -1.2102e-01  8.6691e-01  2.7346      0.0062448 ** 
##  [31,]  9.2584e-02 -8.5393e-05  6.9586e-04  3.5130      0.0004431 ***
##  [32,] -3.1174e-02 -9.1729e-03  5.7403e-02 -0.0918      0.9268343    
##  [33,]  6.4106e-01 -4.5588e-03  3.6983e-02  3.3572      0.0007874 ***
##  [34,] -1.3437e-01 -4.3284e-04  3.2208e-03 -2.3600      0.0182749 *  
##  [35,] -1.8818e-03 -5.0218e-06  3.1717e-05 -0.3332      0.7389483    
##  [36,] -5.0239e-01 -7.1528e-03  5.2867e-02 -2.1539      0.0312505 *  
##  [37,]  1.4153e-02 -4.8535e-05  2.1754e-04  0.9629      0.3356070    
##  [38,]  4.0998e-01 -3.6404e-03  3.2582e-02  2.2915      0.0219368 *  
##  [39,]  1.6427e-02 -5.2015e-03  7.6056e-02  0.0784      0.9374896    
##  [40,] -2.7545e-01 -1.2675e-03  1.1371e-02 -2.5712      0.0101353 *  
##  [41,] -1.2604e-01 -3.7519e-02  1.2875e-01 -0.2467      0.8051351    
##  [42,]  3.6265e-01 -5.1487e-02  1.8386e-01  0.9658      0.3341195    
##  [43,]  1.7248e-03 -1.1431e-06  3.8659e-06  0.8778      0.3800330    
##  [44,] -3.3785e-01 -1.1374e-02  3.8030e-02 -1.6741      0.0941034 .  
##  [45,]  3.0104e-01 -1.2465e-02  4.1632e-02  1.5365      0.1244130    
##  [46,]  6.7195e-02 -1.4421e-03  4.8702e-03  0.9835      0.3253470    
##  [47,]  1.4938e-01 -2.7255e-02  9.4529e-02  0.5745      0.5656223    
##  [48,]  4.3522e-01 -1.4718e-02  5.4593e-02  1.9257      0.0541442 .  
##  [49,] -1.6736e-01 -4.1614e-03  1.2665e-02 -1.4502      0.1470058    
##  [50,]  4.1369e-01 -3.7769e-02  1.1676e-01  1.3212      0.1864341    
##  [51,] -5.0223e-01 -3.4350e-02  9.2048e-02 -1.5421      0.1230389    
##  [52,]  3.6965e-01 -2.8057e-03  2.0828e-02  2.5808      0.0098569 ** 
##  [53,] -3.0961e-01 -1.0434e-02  2.8654e-02 -1.7674      0.0771670 .  
##  [54,] -1.4140e-02 -6.2934e-05  2.1283e-04 -0.9649      0.3345770    
##  [55,]  2.0417e-01 -5.6924e-03  1.5707e-02  1.6745      0.0940283 .  
##  [56,]  3.0584e-03 -6.8129e-05  3.2507e-04  0.1734      0.8623295    
##  [57,]  4.8415e-01 -4.2565e-02  1.3093e-01  1.4556      0.1454901    
##  [58,] -1.3320e-02 -6.0679e-04  2.0509e-03 -0.2807      0.7789243    
##  [59,] -1.3369e-02 -3.2063e-05  7.7571e-05 -1.5143      0.1299608    
##  [60,]  5.3118e-02 -5.1915e-04  1.2013e-03  1.5475      0.1217365    
##  [61,]  1.0467e-01 -1.0876e-03  2.5153e-03  2.1086      0.0349789 *  
##  [62,] -4.9491e-02 -6.3766e-03  2.2590e-02 -0.2869      0.7742217    
##  [63,]  7.2047e-02 -4.2040e-03  1.9976e-02  0.5395      0.5895414    
##  [64,] -2.1793e-01 -4.1259e-03  1.4650e-02 -1.7665      0.0773166 .  
##  [65,] -2.9614e-01 -1.2994e-03  9.6605e-03 -2.9998      0.0027018 ** 
##  [66,]  9.5520e-02 -1.4102e-02  4.9570e-02  0.4924      0.6224591    
##  [67,]  4.5932e-02 -1.8184e-02  5.7360e-02  0.2677      0.7889236    
##  [68,]  9.3542e-01 -4.6004e-02  2.2354e-01  2.0758      0.0379153 *  
##  [69,]  1.3055e-01 -5.0112e-03  5.5872e-02  0.5735      0.5663029    
##  [70,]  1.2863e-01 -2.1095e-03  6.1268e-03  1.6702      0.0948753 .  
##  [71,]  2.1775e-01 -1.4675e-03  1.1942e-02  2.0060      0.0448548 *  
##  [72,] -5.2296e-02 -1.0877e-03  5.9246e-03 -0.6653      0.5058642    
##  [73,] -4.2840e-02 -7.6232e-04  4.1538e-03 -0.6529      0.5138407    
##  [74,] -7.4349e-02 -2.2058e-04  1.5084e-03 -1.9087      0.0563044 .  
##  [75,]  2.4038e-03 -1.7851e-07  6.3646e-07  3.0134      0.0025836 ** 
##  [76,]  3.0589e-02 -1.8076e-04  4.1842e-04  1.5042      0.1325193    
##  [77,]  3.3824e-01 -6.9083e-03  3.2737e-02  1.9076      0.0564413 .  
##  [78,]  5.1673e-01 -8.2918e-03  8.2092e-02  1.8324      0.0668895 .  
##  [79,] -2.1323e-02 -9.0292e-04  2.3893e-03 -0.4178      0.6761299    
##  [80,] -3.5618e-02 -1.5616e-04  4.3329e-04 -1.7036      0.0884505 .  
##  [81,]  7.7589e-02 -9.7284e-03  3.2582e-02  0.4837      0.6285717    
##  [82,] -7.0921e-02 -2.3914e-03  8.5061e-03 -0.7430      0.4574578    
##  [83,]  1.3071e-01 -1.9582e-03  5.9725e-03  1.7166      0.0860512 .  
##  [84,] -1.2850e-02 -7.8278e-06  2.9469e-05 -2.3657      0.0179962 *  
##  [85,]  2.9051e-02 -5.4606e-03  2.0445e-02  0.2414      0.8092748    
##  [86,]  2.2357e-01 -2.4572e-03  7.8750e-03  2.5470      0.0108643 *  
##  [87,]  3.9491e-01 -8.9711e-03  4.2424e-02  1.9609      0.0498962 *  
##  [88,]  7.6021e-02 -1.7009e-03  6.7619e-03  0.9452      0.3445681    
##  [89,]  2.7646e-01 -1.9951e-03  1.9878e-02  1.9750      0.0482679 *  
##  [90,] -7.2328e-02 -3.4831e-04  1.1776e-03 -2.0975      0.0359467 *  
##  [91,]  1.7124e-01 -1.9620e-03  6.6226e-03  2.1284      0.0333060 *  
##  [92,]  2.2277e-01 -2.9446e-03  1.3159e-02  1.9676      0.0491136 *  
##  [93,] -1.6416e-01 -4.6451e-03  2.0724e-02 -1.1081      0.2678358    
##  [94,] -8.5334e-02 -2.9359e-04  1.1688e-03 -2.4875      0.0128645 *  
##  [95,]  1.4523e-01 -3.1646e-02  1.0926e-01  0.5351      0.5925808    
##  [96,]  3.4949e-02 -9.9883e-04  6.3022e-03  0.4528      0.6506747    
##  [97,] -3.7727e-02 -7.8684e-04  4.6053e-03 -0.5443      0.5862018    
##  [98,] -8.3274e-02 -3.7601e-03  1.2669e-02 -0.7064      0.4799202    
##  [99,] -4.5113e-02 -1.8822e-04  8.9800e-04 -1.4992      0.1338279    
## [100,] -5.3629e-01 -1.0667e-02  5.0357e-02 -2.3423      0.0191634 *  
## [101,]  4.6925e-01 -3.1158e-02  2.0648e-01  1.1013      0.2707805    
## [102,]  1.3653e-02 -1.0162e-05  5.9525e-05  1.7710      0.0765650 .  
## [103,]  1.8685e-01 -2.6668e-03  1.6798e-02  1.4622      0.1436856    
## [104,] -8.6863e-03 -3.2087e-05  2.8823e-04 -0.5098      0.6102264    
## [105,]  2.9290e-02 -1.9567e-04  6.9752e-03  0.3531      0.7240497    
## [106,] -2.0335e-02 -1.2801e-03  1.0419e-02 -0.1867      0.8519111    
## [107,]  2.5801e-01 -5.5871e-03  3.5090e-02  1.4072      0.1593723    
## [108,]  4.9384e-02 -2.7835e-04  4.0901e-03  0.7765      0.4374357    
## [109,]  6.4535e-02 -1.2828e-03  1.3965e-01  0.1761      0.8601927    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the spatial data against its spatially lagged values (the weighted mean of its neighbors)                         </span><span class="w">
</span><span class="n">nci</span><span class="o">&lt;-</span><span class="n">moran.plot</span><span class="p">(</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">,</span><span class="w"> </span><span class="n">listw</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Log prevalence"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Spatially lagged log prev"</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="m">-5</span><span class="p">),</span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">-1.9</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">-1.9</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"High-High"</span><span class="p">,</span><span class="w"> </span><span class="s2">"High-Low"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Low-High"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Low-Low"</span><span class="p">),</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-20-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Map points that are local outliers in the plot</span><span class="w">
</span><span class="n">infl</span><span class="o">&lt;-</span><span class="n">nci</span><span class="o">$</span><span class="n">is_inf</span><span class="o">==</span><span class="nb">T</span><span class="w"> </span><span class="c1"># find which points are statistically significant outliers</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">infl</span><span class="o">==</span><span class="nb">T</span><span class="p">)</span><span class="w">    </span><span class="c1">#13 true (12% - more than would expect by chance)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 13
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">&lt;-</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="w">
</span><span class="n">lhx</span><span class="o">&lt;-</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"L"</span><span class="p">,</span><span class="w"> </span><span class="s2">"H"</span><span class="p">),</span><span class="w"> </span><span class="n">include.lowest</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="n">wx</span><span class="o">&lt;-</span><span class="n">lag</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">BF_malaria_data</span><span class="o">$</span><span class="n">log_odds</span><span class="p">)</span><span class="w">
</span><span class="n">lhwx</span><span class="o">&lt;-</span><span class="n">cut</span><span class="p">(</span><span class="n">wx</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">wx</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">wx</span><span class="p">),</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">wx</span><span class="p">)),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"L"</span><span class="p">,</span><span class="w"> </span><span class="s2">"H"</span><span class="p">),</span><span class="w"> </span><span class="n">include.lowest</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">lhlh</span><span class="o">&lt;-</span><span class="n">interaction</span><span class="p">(</span><span class="n">lhx</span><span class="p">,</span><span class="n">lhwx</span><span class="p">,</span><span class="n">infl</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="n">names</span><span class="o">&lt;-</span><span class="nf">rep</span><span class="p">(</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lhlh</span><span class="p">))</span><span class="w">
</span><span class="n">names</span><span class="p">[</span><span class="n">lhlh</span><span class="o">==</span><span class="s2">"L.L.TRUE"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"LL"</span><span class="w">
</span><span class="n">names</span><span class="p">[</span><span class="n">lhlh</span><span class="o">==</span><span class="s2">"H.L.TRUE"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"HL"</span><span class="w">
</span><span class="n">names</span><span class="p">[</span><span class="n">lhlh</span><span class="o">==</span><span class="s2">"L.H.TRUE"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"LH"</span><span class="w">
</span><span class="n">names</span><span class="p">[</span><span class="n">lhlh</span><span class="o">==</span><span class="s2">"H.H.TRUE"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"HH"</span><span class="w">
</span></code></pre></div></div>

<p>We can map the points to show the local clusters.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BF_malaria_localM</span><span class="o">&lt;-</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">names</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">BF_malaria_localM</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"names"</span><span class="p">)</span><span class="w">
</span><span class="n">BF_malaria_localM</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="w"> </span><span class="n">BF_malaria_localM</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">)],</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">factpal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorFactor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="s2">"cyan4"</span><span class="p">,</span><span class="s2">"coral4"</span><span class="p">,</span><span class="s2">"coral"</span><span class="p">,</span><span class="s2">"cyan"</span><span class="p">,</span><span class="s2">"lightgrey"</span><span class="p">),</span><span class="w"> </span><span class="n">names</span><span class="p">)</span><span class="w">
</span><span class="n">leaflet</span><span class="p">(</span><span class="n">BF_malaria_localM</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="o">~</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
                                                               </span><span class="n">color</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">factpal</span><span class="p">(</span><span class="n">names</span><span class="p">),</span><span class="w"> </span><span class="n">radius</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">stroke</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factpal</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Class"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-23-1.png" alt="" /></p>

<h2 id="part-ii-examining-spatial-point-processes">Part II: Examining spatial point processes</h2>

<p>In this section we’re going to look at a different type of point data,
point process data, and some of the tests we can use to examine spatial
autocorrelation in these data.</p>

<p>First we are going to load obfuscated malaria case data from northern
Namibia.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CaseControl</span><span class="o">&lt;-</span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/phw272c/phw272c.github.io/master/data/CaseControl.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1">#  boundary file</span><span class="w">
</span><span class="n">NAM_Adm0</span><span class="o">&lt;-</span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="s1">'GADM'</span><span class="p">,</span><span class="n">country</span><span class="o">=</span><span class="s1">'NAM'</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can convert the data to a SPDF and plot the cases and ‘controls’</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CaseControl_SPDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">SpatialPointsDataFrame</span><span class="p">(</span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CaseControl</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"long"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lat"</span><span class="p">)],</span><span class="w">
                                           </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CaseControl</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"household_id"</span><span class="p">,</span><span class="w"> </span><span class="s2">"case"</span><span class="p">)])</span><span class="w">
</span><span class="n">cases</span><span class="o">&lt;-</span><span class="n">CaseControl_SPDF</span><span class="p">[</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">case</span><span class="o">==</span><span class="m">1</span><span class="p">,]</span><span class="w">
</span><span class="n">controls</span><span class="o">&lt;-</span><span class="n">CaseControl_SPDF</span><span class="p">[</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">case</span><span class="o">==</span><span class="m">0</span><span class="p">,]</span><span class="w">

</span><span class="c1"># Let's plot and see what we have</span><span class="w">
</span><span class="n">case_color_scheme</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">CaseControl_SPDF</span><span class="o">$</span><span class="n">case</span><span class="p">)</span><span class="w">
</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">CaseControl_SPDF</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_color_scheme</span><span class="p">(</span><span class="n">CaseControl_SPDF</span><span class="o">$</span><span class="n">case</span><span class="p">),</span><span class="w">
                                              </span><span class="n">radius</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-25-1.png" alt="" /></p>

<p>In the previous lecture, you already generated first order kernel
density estimates and calculated the ratio of the density estimate of
cases:controls. Now you will look at second order functions, summarizing
the spatial dependence between events</p>

<p>We need to change the case data to a PPP data type (‘point pattern’)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CasesPPP</span><span class="o">&lt;-</span><span class="n">as</span><span class="p">(</span><span class="n">cases</span><span class="p">,</span><span class="w"> </span><span class="s2">"ppp"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We use Ripley’s K function to summarize the spatial dependence between
events at a wide range of spatial scales</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">K</span><span class="o">&lt;-</span><span class="n">Kest</span><span class="p">(</span><span class="n">CasesPPP</span><span class="p">,</span><span class="n">correction</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"isotropic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ripley"</span><span class="p">))</span><span class="w">    </span><span class="c1">#uses the "spatstat" package</span><span class="w">

</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="c1"># Plot the estimate of K(r); note different border-corrected estimates ('iso', 'border' and 'trans')</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"d (dd)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"K(dd)"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Red dashed line is expected K value computed for a CRS process</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-27-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E</span><span class="o">&lt;-</span><span class="n">envelope</span><span class="p">(</span><span class="n">CasesPPP</span><span class="p">,</span><span class="w"> </span><span class="n">Kest</span><span class="p">,</span><span class="w"> </span><span class="n">nsim</span><span class="o">=</span><span class="m">999</span><span class="p">)</span><span class="w"> </span><span class="c1"># Plot confidence envelope using MC simulation</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-29-1.png" alt="" /></p>

<p>The K-function computed for cases assumes that H0 is complete spatial
randomness. What are the limitations of this assumption?</p>

<p>Next we can look at the difference in Ripley’s K function between cases
and controls, using two approaches that do essentially the same thing;
#2 with hypothesis testing.</p>

<p>Approach 1: K function vignette from Bradley et al simply calculates the
K function for cases and controls, and evaluates the difference.</p>

<p>First create a marked point process.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CaseControlPPP</span><span class="o">&lt;-</span><span class="n">ppp</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">CaseControl</span><span class="o">$</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">long</span><span class="p">),</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">lat</span><span class="p">),</span><span class="w"> </span><span class="n">marks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">case</span><span class="p">))</span><span class="w">

</span><span class="c1"># Calculate the K-function for cases</span><span class="w">
</span><span class="n">KX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Kest</span><span class="p">(</span><span class="n">CaseControlPPP</span><span class="p">[</span><span class="n">CaseControlPPP</span><span class="o">$</span><span class="n">marks</span><span class="o">==</span><span class="m">1</span><span class="p">],</span><span class="n">correction</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"isotropic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ripley"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">KX</span><span class="p">,</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">iso</span><span class="o">/</span><span class="nb">pi</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-30-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate the K-function for controls</span><span class="w">
</span><span class="n">KY</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Kest</span><span class="p">(</span><span class="n">CaseControlPPP</span><span class="p">[</span><span class="n">CaseControlPPP</span><span class="o">$</span><span class="n">marks</span><span class="o">==</span><span class="m">0</span><span class="p">],</span><span class="n">correction</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"isotropic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ripley"</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">KY</span><span class="p">,</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">iso</span><span class="o">/</span><span class="nb">pi</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-30-2.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calulate the difference in the two functions</span><span class="w">
</span><span class="n">Kdiff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eval.fv</span><span class="p">(</span><span class="n">KX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">KY</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Kdiff</span><span class="p">,</span><span class="w"> </span><span class="n">legendpos</span><span class="o">=</span><span class="s2">"float"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-30-3.png" alt="" /></p>

<p>Approach 2: “Smacpod” package includes a function to estimate the
difference in K function and plot simulated CI. Also includes a function
to the test the significance based on these simulations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kdest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kdest</span><span class="p">(</span><span class="n">CaseControlPPP</span><span class="p">,</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="n">nsim</span><span class="o">=</span><span class="m">999</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">correction</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"isotropic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ripley"</span><span class="p">))</span><span class="w">  </span><span class="c1">#"smacpod" package</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 1 has been selected as the case group
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Note that the case = is position of the marks, not the value!  levels(CaseControlPPP$marks)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">kdest</span><span class="p">)</span><span class="w"> </span><span class="c1"># dark grey is min/max; light grey is confidence envelope (can change these with options)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-32-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kdplus.test</span><span class="p">(</span><span class="n">kdest</span><span class="p">)</span><span class="w"> </span><span class="c1"># Performs test of significance based on simulated confidence envelope and observed statistic</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
## Diggle and Chetwynd (1991) test for difference in K functions
## 
## KD(r) = K_case(r) - K_control(r)
## case label:  1 
## control label:  0 
## 
## null hypothesis: KD(r) = 0 for all r between 0 and 0.1653646 
## alternative hypothesis: KD(r) &gt; 0 for at least one r between 0 and 0.1653646 
## test statistic: 859.8309 
## p-value: 0.024 
## nsim: 999 
## simulation procedure: random labeling
</code></pre></div></div>

<h2 id="spatial-scan-statistics">Spatial Scan Statistics</h2>

<p>Finally we will look at spatial scan statistics using R.</p>

<p>On your own, you can also explore using SatScan, a free software tool
for spatial scan statistics that <a href="http://www.satscan.org/">you can find
here</a>.</p>

<p>For this exercise, we will use the “smacpod” library in R to run the
Kulldorf spatial scan statistic.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert CaseControl to a "PPP" object for spatial scan</span><span class="w">
</span><span class="n">CaseControlPPP</span><span class="o">&lt;-</span><span class="n">ppp</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">CaseControl</span><span class="o">$</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">long</span><span class="p">),</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">lat</span><span class="p">),</span><span class="w"> </span><span class="n">marks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">CaseControl</span><span class="o">$</span><span class="n">case</span><span class="p">))</span><span class="w">

</span><span class="n">out</span><span class="o">&lt;-</span><span class="n">spscan.test</span><span class="p">(</span><span class="n">CaseControlPPP</span><span class="p">,</span><span class="w"> </span><span class="n">nsim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999</span><span class="p">,</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">maxd</span><span class="o">=</span><span class="m">.15</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">    </span><span class="c1"># "smacpod" library</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 1 has been selected as the case group
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">CaseControlPPP</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-33-1.png" alt="" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">case_color_scheme</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">CaseControl_SPDF</span><span class="o">$</span><span class="n">case</span><span class="p">)</span><span class="w">
</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">CaseControl_SPDF</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_color_scheme</span><span class="p">(</span><span class="n">CaseControl_SPDF</span><span class="o">$</span><span class="n">case</span><span class="p">),</span><span class="w"> 
                                              </span><span class="n">stroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">addCircles</span><span class="p">(</span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="o">$</span><span class="n">clusters</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">coords</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="o">$</span><span class="n">clusters</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">coords</span><span class="p">[,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
             </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="o">$</span><span class="n">clusters</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">r</span><span class="o">*</span><span class="m">112</span><span class="o">*</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/week-4/unnamed-chunk-33-2.png" alt="" /></p>

<h2 id="key-readings">Key Readings</h2>

<p>Pullan, R. L., H. J. Sturrock, et al. (2012). “Spatial parasite ecology
and epidemiology: a review of methods and applications.” Parasitology
139(14): 1870-1887.</p>

<p>Pfeiffer DU, Robinson TP, Stevenson M, Stevens KB, Rogers DJ &amp; Clements
ACA (2008). Spatial Analysis in Epidemiology. Chapters 4 &amp; 5. Oxford
University Press, Oxford, UK.</p>

<h2 id="citation-for-the-leukemia-data">Citation for the leukemia data</h2>

<p>Turnbull, B. W. et al (1990) Monitoring for clusters of disease:
application to leukemia incidence in upstate New York American Journal
of Epidemiology, 132, 136-143</p>

<h2 id="other-good-resources">Other good resources</h2>

<p>Waller LA, Gotway CA (2004) Applied Spatial Statistics for Public Health
Data. John Wiley &amp; Sons, Hoboken, New Jersey.</p>

<ul>
  <li>R library rsatscan can be used to run SatScan from R, see also here:
<a href="https://www.satscan.org/rsatscan/rsatscan.html">rsatscan</a></li>
</ul>

<h2 id="selection-of-research-applications">Selection of research applications</h2>

<p>Bejon, P., T. N. Williams, et al. (2014). “A micro-epidemiological
analysis of febrile malaria in Coastal Kenya showing hotspots within
hotspots.” Elife 3: e02130.</p>

<p>Brooker S, Clarke S, Njagi JK, Polack S, Mugo B, Estambale B, Muchiri E,
Magnussen P &amp; Cox J (2004). Spatial clustering of malaria and associated
risk factors during an epidemic in a highland area of western Kenya.
Tropical Medicine and International Health 9: 757-766.</p>

<p>Fevre EM, Coleman PG, Odiit M, et al. (2001). The origins of a new
Trypanosoma brucei rhodesiense sleeping sickness outbreak in eastern
Uganda. Lancet 358: 625-628.</p>

<p>Huillard d’Aignaux J, Cousens SN, Delasnerie-Laupretre N, Brandel JP,
Salomon D, Laplanche JL, Hauw JJ &amp; Alperovitch A (2002). Analysis of the
geographical distribution of sporadic Creutzfeldt-Jakob disease in
France between 1992 and 1998. International Journal of Epidemiology 31:
490-495.</p>

<p>Gaudart J, Poudiougou B, Dicko A, et al. (2006). Space-time clustering
of childhood malaria at the household level: a dynamic cohort in a Mali
village. BMC Public Health 6: 286.</p>

<p>Kulldorff M, Athas WF, Feuer EJ, Miller BA &amp; Key CR (1998). Evaluating
cluster alarms: A Space-Time Scan Statistic and Brain Cancer in Los
Alamos, New Mexico. American Journal of Public Health 88, 1377-1380.</p>

<p>Kulldorff M &amp; Nagarwalla N (1995). Spatial disease clusters: Detection
and inference. Statistics in Medicine 14, 799-819. Odoi A, Martin SW,
Michel P, et al. (2004). Investigation of clusters of giardiasis using
GIS and a spatial scan statistic. Int J Health Geogr 3: 11.</p>

<p>Mosha, J. F., H. J. Sturrock, et al. (2014). “Hot spot or not: a
comparison of spatial statistical methods to predict prospective malaria
infections.” Malar J 13: 53.</p>

<p>Ngowi HA, Kassuku AA, Carabin H, et al. (2010). Spatial clustering of
porcine cysticercosis in Mbulu district, northern Tanzania. PLoS Negl
Trop Dis 4: e652.</p>

<p>Peterson I, Borrell LN, El-Sadr W, et al. (2009). A temporal-spatial
analysis of malaria transmission in Adama, Ethiopia. Am J Trop Med Hyg
81: 944-949.</p>

<p>Sissoko, M. S., L. L. van den Hoogen, et al. (2015). “Spatial Patterns
of Plasmodium falciparum Clinical Incidence, Asymptomatic Parasite
Carriage and Anopheles Density in Two Villages in Mali.” Am J Trop Med
Hyg 93(4): 790-797.</p>

<p>Washington CH, Radday J, Streit TG, et al. (2004). Spatial clustering of
filarial transmission before and after a Mass Drug Administration in a
setting of low infection prevalence. Filaria J 3: 3.</p>

  </div><a class="u-url" href="/week-4/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p>This course has been developed over the years by many contributors including Hugh Sturrock, Adam Bennett, Francois Rerolle, Ricardo Andrade, Adam Readhead, David Connell, and Erika Foster. <a href="/about">Read about the team</a>.</p>
      </div>
    </div>

  </div>

</footer></body>

</html>
