<html lang="en_US"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --><title>Week 1 - Visualizing spatial data | Applied Spatial Data Science for Public Health</title><meta name="generator" content="Jekyll v3.9.1" /><meta property="og:title" content="Week 1 - Visualizing spatial data" /><meta name="author" content="UC Berkeley School of Public Health" /><meta property="og:locale" content="en_US" /><meta name="description" content="Week 1 - visualizing spatial data" /><meta property="og:description" content="Week 1 - visualizing spatial data" /><link rel="canonical" href="http://localhost:4000/week-1/" /><meta property="og:url" content="http://localhost:4000/week-1/" /><meta property="og:site_name" content="Applied Spatial Data Science for Public Health" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-11-26T00:00:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Week 1 - Visualizing spatial data" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"UC Berkeley School of Public Health"},"dateModified":"2017-11-26T00:00:00-08:00","datePublished":"2017-11-26T00:00:00-08:00","description":"Week 1 - visualizing spatial data","headline":"Week 1 - Visualizing spatial data","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/week-1/"},"url":"http://localhost:4000/week-1/"}</script> <!-- End Jekyll SEO tag --><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77"><link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77"><link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5"> <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]--><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><meta name="apple-mobile-web-app-title" content="Sleek"><meta name="application-name" content="Sleek"><meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77"><meta name="theme-color" content="#ffffff"><style class="inlineCSS"> h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#313237}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:block;position:absolute;top:3.75em;left:0;width:100%;height:auto;visibility:hidden;background:#fff}.header__link{color:#343851;padding:1em 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;display:-webkit-box;display:-ms-flexbox;display:flex;visibility:visible;width:auto;height:100%}.header__link{position:relative;padding:.938em 0;border:0}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:5.26316%}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);max-width:40em;z-index:1}.hero__wrap .hero__title{color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap .hero__title{font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}</style><link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <script type="text/javascript"> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ (function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}} var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1} return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia} if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)} setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return} var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}} if(typeof exports!=="undefined"){exports.loadCSS=loadCSS} else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this)) </script></head><body class="site"><header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation"><div class="container"><div class="header__inner"><nav class="header__links"><div class="container header__links-wrapper"> <a class="header__link" href="/" itemprop="url"><span itemprop="name">Home</span></a> <a class="header__link" href="/about" itemprop="url"><span itemprop="name">About</span></a> </a></div></nav><div class="header__toggle"> <span></span> <span></span> <span></span></div></div></div></header><div class="hero lazyload" data-bg="http://localhost:4000/assets/img/posts/hexbin_bruiser.jpg"><div class="hero__wrap"><h1 class="hero__title">Week 1 - Visualizing spatial data</h1><p class="hero__meta"> <!-- <span> <time>26 Nov 2017</time>&nbsp; </span>--> <span> </span></p></div></div></div><main class="site__content"><div class="container"><article class="post-content" itemprop="articleBody"><h2 id="week-1---visualizing-spatial-data">Week 1 - visualizing spatial data</h2><p>Welcome to week 1 of spatial analysis for public health. This week we will be learning about the process of moving from visualizing spatial data through to exploration and analysis. We will get our hands dirty with some R code and learn how to make beautiful maps. This week’s lecture will focus on some of the concepts behind spatial epidemiology. The code below covers loading and visualizing spatial data in R. You will then have a chance to apply that code to new data and questions in this week’s assignment.</p><h2 id="lab-1-working-with-spatial-data-in-r">Lab 1: Working with Spatial Data in R</h2><p>The simplest data is a table with coordinates (i.e. point data). For this assignment, we’ll work with malaria prevalence point data from Ethiopia. These data were downloaded from the <a href="https://malariaatlas.org/">Malaria Atlas Project</a> data repository and were originally collected as part of <a href="https://link.springer.com/article/10.1186/1475-2875-10-25">a study</a> conducted in 2009.</p><p>First load the necessary libraries for this week. Hint - if you don’t have copes of the libraries on your machine you will have to install them, e.g. <code class="language-plaintext highlighter-rouge">install.packages("sp")</code></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span></code></pre></figure><p>Import the data</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ETH_malaria_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week1/Lab_files/Data/mal_data_eth_2009_no_dups.csv"</span><span class="p">,</span><span class="w">
                            </span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span></code></pre></figure><p>The columns should be self-explanatory, but briefly:</p><ul><li>examined = numbers tested</li><li>pf_pos = of those tested, how many were positive for Plasmodium falciparum malaria</li><li>pf_pr = Plasmodium falciparum parasite rate which is the same as infection prevalence or proportion infected (i.e. pf_pos / examined)</li><li>longitude = longitude of school in decimal degrees</li><li>latitude = latitude of school in decimal degrees</li></ul><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">ETH_malaria_data</span><span class="p">)</span><span class="w"> </span><span class="c1"># gives you the first few rows</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##    country country_id continent_id site_id          site_name latitude
## 1 Ethiopia        ETH       Africa    6694        Dole School   5.9014
## 2 Ethiopia        ETH       Africa    8017     Gongoma School   6.3175
## 3 Ethiopia        ETH       Africa   12873      Buriya School   7.5674
## 4 Ethiopia        ETH       Africa    6533       Arero School   4.7192
## 5 Ethiopia        ETH       Africa    4150     Gandile School   4.8930
## 6 Ethiopia        ETH       Africa    1369 Melka Amana School   6.2461
##   longitude rural_urban year_start lower_age upper_age examined pf_pos
## 1   38.9412     UNKNOWN       2009         4        15      220      0
## 2   39.8362     UNKNOWN       2009         4        15      216      0
## 3   40.7521     UNKNOWN       2009         4        15      127      0
## 4   38.7650     UNKNOWN       2009         4        15       56      0
## 5   37.3632     UNKNOWN       2009         4        15      219      0
## 6   39.7891     UNKNOWN       2009         4        15      215      1
##         pf_pr     method
## 1 0.000000000 Microscopy
## 2 0.000000000 Microscopy
## 3 0.000000000 Microscopy
## 4 0.000000000 Microscopy
## 5 0.000000000 Microscopy
## 6 0.004651163 Microscopy
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Create a histogram of the prevalence</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">20</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-3-1.png" alt="" /><!-- --></p><h1 id="plotting-and-mapping-spatial-data">Plotting and mapping spatial data</h1><p>It is possible to use R’s base graphics to plot points, treating them like any other data with x and y coordinates. For example, to get a plot of the points alone</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Latitude"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Longitude"</span><span class="p">)</span><span class="w"> </span><span class="c1">#boring!</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-4-1.png" alt="" /><!-- --></p><p>You might want to vary the size of the circle as a function of a variable. For example, if we wanted to plot points with size relative to prevalence we can use the expansion argument <code class="language-plaintext highlighter-rouge">cex</code></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Use the cex function to plot circle size as a function of a variable</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">,</span><span class="w">
     </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">pf_pr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Latitude"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Longitude"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-5-1.png" alt="" /><!-- --></p><h2 id="working-with-spatial-objects">Working with ‘Spatial’ objects</h2><p>In R, it is sometimes useful to package spatial data up into a ‘Spatial’ class of object using the <code class="language-plaintext highlighter-rouge">sp</code> package. This often makes it easier to work with and is often a requirement for other functions. The <a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a> package allows you to put your data into specific spatial objects, such as <code class="language-plaintext highlighter-rouge">SpatialPoints</code> or <code class="language-plaintext highlighter-rouge">SpatialPolygons</code>. In addition, if your data are more than just the geometry, i.e. if you have data associated with each spatial feature, you can create spatial DataFrames, i.e. <code class="language-plaintext highlighter-rouge">SpatialPointsDataFrames</code> and <code class="language-plaintext highlighter-rouge">SpatialPolygonsDataFrames</code>. For example, if we wanted to create a SpatalPointsDataFrame using the Ethiopia data:</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ETH_malaria_data_SPDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">SpatialPointsDataFrame</span><span class="p">(</span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">)],</span><span class="w">
                                      </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"examined"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pf_pos"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pf_pr"</span><span class="p">)],</span><span class="w">
                                      </span><span class="n">proj4string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s2">"+init=epsg:4326"</span><span class="p">))</span><span class="w"> </span><span class="c1"># sets the projection to WGS 1984 using lat/long. Optional but good to specify</span><span class="w">

</span><span class="c1"># Summary of object</span><span class="w">
</span><span class="n">ETH_malaria_data_SPDF</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class       : SpatialPointsDataFrame 
## features    : 203 
## extent      : 34.5418, 42.4915, 3.8966, 9.9551  (xmin, xmax, ymin, ymax)
## crs         : +init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## variables   : 3
## names       : examined, pf_pos,       pf_pr 
## min values  :       37,      0,           0 
## max values  :      221,     14, 0.127272727
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># SPDFs partition data elements, e.g. the coordinates are stored separately from the data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">@</span><span class="n">coords</span><span class="p">)</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      longitude latitude
## [1,]   38.9412   5.9014
## [2,]   39.8362   6.3175
## [3,]   40.7521   7.5674
## [4,]   38.7650   4.7192
## [5,]   37.3632   4.8930
## [6,]   39.7891   6.2461
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">@</span><span class="n">data</span><span class="p">)</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##   examined pf_pos       pf_pr
## 1      220      0 0.000000000
## 2      216      0 0.000000000
## 3      127      0 0.000000000
## 4       56      0 0.000000000
## 5      219      0 0.000000000
## 6      215      1 0.004651163
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># You can quickly access the data frame as per a standard data frame, e.g.</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">)</span></code></pre></figure><p>## [1] 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.004651163</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># You can use the plot or spplot function to get quick plots</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-6-1.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">spplot</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">,</span><span class="w"> </span><span class="n">zcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pf_pr"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-6-2.png" alt="" /><!-- --></p><p>Let’s have a look at SpatialPolygonsDataFrames. To load a polygon shapefile (or other file types), you can use the <code class="language-plaintext highlighter-rouge">readOGR</code> function from the <code class="language-plaintext highlighter-rouge">rgdal</code> package. For example, if you wanted to load in the province boundaries for Ethiopia shapefile <code class="language-plaintext highlighter-rouge">ETH_Adm_1</code> from the <code class="language-plaintext highlighter-rouge">ETH_Adm_1_shapefile.zip</code> folder on <a href="https://github.com/HughSt/HughSt.github.io/raw/master/course_materials/week1/Lab_files/Data/ETH_Adm1_shapefile.zip">GitHub</a>, assuming you have downloaded the folder of files you would use the following command</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ETH_Adm_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readOGR</span><span class="p">(</span><span class="s2">"ETH_Adm_1_shapefile"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ETH_Adm_1"</span><span class="p">)</span></code></pre></figure><p>As it happens, admin boundary data is accessible using the <code class="language-plaintext highlighter-rouge">getData</code> function from the <code class="language-plaintext highlighter-rouge">raster</code> package. Be careful as some other packages also have a <code class="language-plaintext highlighter-rouge">getData</code> function, so to specify that you want to use the <code class="language-plaintext highlighter-rouge">getData</code> function from the <code class="language-plaintext highlighter-rouge">raster</code> package you can use the following code</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># You first need the ISO3 codes for the country of interest. You can access these using `ccodes()`. For Ethiopia, the ISO3 is ETH.</span><span class="w">

</span><span class="c1"># The getData function then allows you to retrieve the relevant admin level boundaries from GADM.</span><span class="w">
</span><span class="n">ETH_Adm_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="s2">"GADM"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s2">"ETH"</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span></code></pre></figure><p>Now we can plot the point data in context</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Plot both country and data points</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">ETH_Adm_1</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">latitude</span><span class="p">,</span><span class="w">
     </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data</span><span class="o">$</span><span class="n">pf_pr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Latitude"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Longitude"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-8-1.png" alt="" /><!-- --></p><h1 id="plotting-data-using-web-maps">Plotting data using web maps</h1><p>Rather than just relying on R base graphics, we can easily create webmaps using the <code class="language-plaintext highlighter-rouge">leaflet</code> package. There are many basemaps available. See <a href="https://leaflet-extras.github.io/leaflet-providers/preview/">here</a>. For any map, identify the Provider name, e.g. “OpenStreetMap.Mapnik”, by clicking on the map.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Define your basemap</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addTiles</span><span class="p">()</span><span class="w">
</span><span class="n">basemap</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet1.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Or choose another basemap</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"Esri.WorldImagery"</span><span class="p">)</span><span class="w">
</span><span class="n">basemap</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_esri.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w">   
</span><span class="c1">#Let's choose a simple one</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span></code></pre></figure><p>You can use the ‘piping’ command %&gt;% to add layers. As our point and polygon data are already ‘Spatial’ object this is easy</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w">    
</span><span class="c1"># to change the colors/line weight</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1_red.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w">   
</span><span class="c1">#You can also add popups</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1_popup.png" alt="" /><!-- --></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w">      
</span><span class="c1"># If you want to add points as well</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                        </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  
            </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">,</span><span class="w">
                             </span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
 </span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1_points.png" alt="" /><!-- --></p><p>The leaflet package also has some nice functions for generating color palettes that map to a variable you want to display. For example, if we wanted to create a color ramp relative to prevalence we could use the <code class="language-plaintext highlighter-rouge">colorNumeric</code> function. See ?colorNumeric for other ways to build color palettes such as <code class="language-plaintext highlighter-rouge">colorBin</code></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">wesanderson</span><span class="p">)</span><span class="w"> </span><span class="c1"># for a nice color palette</span><span class="w">
</span><span class="n">colorPal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">wes_palette</span><span class="p">(</span><span class="s2">"Zissou1"</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># colorPal is now a function you can apply to get the corresponding</span><span class="w">
</span><span class="c1"># color for a value</span><span class="w">
</span><span class="n">colorPal</span><span class="p">(</span><span class="m">0.6</span><span class="p">)</span><span class="w">

</span><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w">
                        </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      
      </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">,</span><span class="w">
                       </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorPal</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">),</span><span class="w"> 
                       </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                       </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">))</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1_points_wes.png" alt="" /><!-- --></p><p>You might want to add a legend. This just goes on as another layer on the map. First define the labels. In this case, we are using quintiles.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w">
                            </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      
      </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">,</span><span class="w">
                       </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorPal</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">),</span><span class="w"> 
                       </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                       </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      
      </span><span class="n">addLegend</span><span class="p">(</span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorPal</span><span class="p">,</span><span class="w"> 
                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prevalence"</span><span class="p">,</span><span class="w">
                </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin1_points_wes_legend.png" alt="" /><!-- --></p><p>For more complex popups, you can define the HTML</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w">
                        </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  
      </span><span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">,</span><span class="w">
                   </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorPal</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">),</span><span class="w"> 
                   </span><span class="n">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                   </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"&lt;p&gt;"</span><span class="p">,</span><span class="s2">"Prevalence:"</span><span class="p">,</span><span class="w">
                                 </span><span class="nf">round</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w">
                                 </span><span class="s2">"&lt;p&gt;"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">

            </span><span class="n">addLegend</span><span class="p">(</span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colorPal</span><span class="p">,</span><span class="w"> 
                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prevalence"</span><span class="p">,</span><span class="w">
                </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_malaria_data_SPDF</span><span class="o">$</span><span class="n">pf_pr</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_admin_quintile_popup2.png" alt="" /><!-- --></p><h1 id="plotting-raster-data">Plotting raster data</h1><p>If you have a local raster file (e.g. a .tif file), or a URL to a valid .tif, you can use the <code class="language-plaintext highlighter-rouge">raster</code> command to load the file into R. For example, to load <a href="">this</a> raster of elevation in Ethiopia into memory you would use the following:</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">elev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="p">(</span><span class="s2">"https://github.com/HughSt/HughSt.github.io/raw/master/course_materials/week1/Lab_files/Data/elev_ETH.tif"</span><span class="p">)</span></code></pre></figure><p>The <code class="language-plaintext highlighter-rouge">getData</code> functon from the <code class="language-plaintext highlighter-rouge">raster</code> package allows you to get hold of some select raster data, such as elevation and bioclimatic layers. To get hold of elevation for Ethiopia, use the following</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">elev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="s2">"alt"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s2">"ETH"</span><span class="p">)</span><span class="w">
</span><span class="n">elev</span><span class="w">

    </span><span class="c1">## class       : RasterLayer </span><span class="w">
    </span><span class="c1">## dimensions  : 708, 972, 688176  (nrow, ncol, ncell)</span><span class="w">
    </span><span class="c1">## resolution  : 0.008333333, 0.008333333  (x, y)</span><span class="w">
    </span><span class="c1">## extent      : -5.6, 2.5, 9.3, 15.2  (xmin, xmax, ymin, ymax)</span><span class="w">
    </span><span class="c1">## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 </span><span class="w">
    </span><span class="c1">## data source : /Users/sturrockh/Documents/Work/MEI/DiSARM/GitRepos/spatial-epi-course/https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/ETHA_msk_alt.grd </span><span class="w">
    </span><span class="c1">## names       : ETHA_msk_alt </span><span class="w">
    </span><span class="c1">## values      : 143, 704  (min, max)</span><span class="w">
    </span></code></pre></figure><p>You can plot using the standard plot function</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/unnamed-chunk-10-1.png" alt="" /><!-- --></p><p>Alternatively, you can use leaflet</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_raster.png" alt="" /><!-- --></p><p>If you want to add a legend, you have to define the color palette first</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Define palette</span><span class="w">
</span><span class="n">raster_colorPal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">topo.colors</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">elev</span><span class="p">),</span><span class="w"> </span><span class="n">na.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">basemap</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">elev</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span><span class="n">addLegend</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">elev</span><span class="p">),</span><span class="w"> </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week1_files/figure-gfm/leaflet_raster_topo.png" alt="" /><!-- --></p><p>If you want to export the data, there are several options.</p><ol><li><p>Export button in the Viewer pane. Using ‘Save as webpage’ creates an html file which you can open using a browser.</p></li><li><p>Save as kml for someone to open in Google Earth</p></li></ol><!-- end list --><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">plotKML</span><span class="p">)</span><span class="w">
</span><span class="n">plotKML</span><span class="p">(</span><span class="n">ETH_malaria_data_SPDF</span><span class="p">)</span><span class="w"> </span><span class="c1"># see ?plotKML for more options</span></code></pre></figure><h2 id="resources">Resources</h2><p>The R packages <a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a> and <a href="https://cran.r-project.org/web/packages/raster/index.html">raster</a> are both important packages for spatial analysis.</p><p>The <a href="https://r-spatial.github.io/sf/articles/sf1.html">sf</a> package provides an alternative way of handling spatial data. This package can be particularly useful if you have large datasets.</p><p>R studio also have a fantastic <a href="https://rstudio.github.io/leaflet/">site</a> outlining the use of leaflet</p><p><a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/OverviewCoordinateReferenceSystems.pdf">Coordinate systems and R</a></p><p><a href="http://pakillo.github.io/R-GIS-tutorial/">Great general resource for using R for spatial analysis</a></p><p><a href="http://www.scoop.it/t/mapas-con-r">Nice ideas for mapping in R</a></p><p><a href="https://mgimond.github.io/Spatial/index.html">Pretty comprehensive site outlining using R for GIS</a></p><h3 id="key-readings">Key readings</h3><p>Ostfeld, R. S., G. E. Glass and F. Keesing (2005). “Spatial epidemiology: an emerging (or re-emerging) discipline.” Trends in ecology &amp; evolution 20(6): 328-336.</p><p>Pfeiffer, D., T. P. Robinson, M. Stevenson, K. B. Stevens, D. J. Rogers and A. C. Clements (2008). Spatial analysis in epidemiology, Oxford University Press Oxford. Chapters 1-3</p></article></div></main><footer class="footer"><div class="container"><nav class="social"></nav><span>&copy; 2022 Applied Spatial Data Science for Public Health. All rights reserved.</span></div></footer><script async src="/assets/js/bundle.js"></script></body></html>
