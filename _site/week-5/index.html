<html lang="en_US"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --><title>Week 5 - Accessing spatial datasets | Applied Spatial Data Science for Public Health</title><meta name="generator" content="Jekyll v3.9.1" /><meta property="og:title" content="Week 5 - Accessing spatial datasets" /><meta name="author" content="UC Berkeley School of Public Health" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="http://localhost:4000/week-5/" /><meta property="og:url" content="http://localhost:4000/week-5/" /><meta property="og:site_name" content="Applied Spatial Data Science for Public Health" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-10-12T00:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Week 5 - Accessing spatial datasets" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"UC Berkeley School of Public Health"},"dateModified":"2017-10-12T00:00:00-07:00","datePublished":"2017-10-12T00:00:00-07:00","description":"Introduction","headline":"Week 5 - Accessing spatial datasets","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/week-5/"},"url":"http://localhost:4000/week-5/"}</script> <!-- End Jekyll SEO tag --><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77"><link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77"><link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5"> <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]--><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><meta name="apple-mobile-web-app-title" content="Sleek"><meta name="application-name" content="Sleek"><meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77"><meta name="theme-color" content="#ffffff"><style class="inlineCSS"> h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#313237}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:block;position:absolute;top:3.75em;left:0;width:100%;height:auto;visibility:hidden;background:#fff}.header__link{color:#343851;padding:1em 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;display:-webkit-box;display:-ms-flexbox;display:flex;visibility:visible;width:auto;height:100%}.header__link{position:relative;padding:.938em 0;border:0}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:5.26316%}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);max-width:40em;z-index:1}.hero__wrap .hero__title{color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap .hero__title{font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}</style><link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <script type="text/javascript"> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ (function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}} var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1} return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia} if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)} setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return} var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}} if(typeof exports!=="undefined"){exports.loadCSS=loadCSS} else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this)) </script></head><body class="site"><header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation"><div class="container"><div class="header__inner"><nav class="header__links"><div class="container header__links-wrapper"> <a class="header__link" href="/" itemprop="url"><span itemprop="name">Home</span></a> <a class="header__link" href="/about" itemprop="url"><span itemprop="name">About</span></a> </a></div></nav><div class="header__toggle"> <span></span> <span></span> <span></span></div></div></div></header><div class="hero lazyload" data-bg="http://localhost:4000/assets/img/posts/LULC.jpg"><div class="hero__wrap"><h1 class="hero__title">Week 5 - Accessing spatial datasets</h1><p class="hero__meta"> <!-- <span> <time>12 Oct 2017</time>&nbsp; </span>--> <span> </span></p></div></div></div><main class="site__content"><div class="container"><article class="post-content" itemprop="articleBody"><h3 id="introduction">Introduction</h3><p>Last week, we spoke about cluster analysis (week 4) to reveal noteworthy spatial patterns in the outcome data (health related events/measures) and ways to assess spatial autocorrelation. In week 3 (Spatial variation in risk), we also used spatial autocorrelation to interpolate the data (kriging) to produce smooth maps of our outcomes.</p><p>Starting next week and through the end of the class, we will talk about spatial regression modeling which combines regression modeling (first order trend) and spatial autocorrelation modeling (second order trend).</p><p>Today, in this transition session, we will cover some of the ways you can access and generate useful spatial data to incoporate into spatial regression analyses.</p><hr /><hr /><h2 id="accessing-spatial-data">Accessing spatial data</h2><p>Many spatial data have been made directly available within R thanks to bespoke packages, but for some data, you might need to look online or even generate these yourself.</p><hr /><h3 id="from-r-packages"><strong>From R packages</strong></h3><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span></code></pre></figure><p>You have already used spatial data from the “raster” package via the <code class="language-plaintext highlighter-rouge">getData</code> function. Let’s take a deeper dive on these datasets.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Read vignette for details and references</span><span class="w">
</span><span class="o">?</span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">()</span></code></pre></figure><p>So you can download administrative boundaries (option <code class="language-plaintext highlighter-rouge">name = 'GADM'</code>), elevation (<code class="language-plaintext highlighter-rouge">name = 'alt'</code>) and even climate variables (<code class="language-plaintext highlighter-rouge">name = 'worldclim'</code>).</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Ethiopia</span><span class="w">
</span><span class="c1"># Administrative boundaries (level 1)</span><span class="w">
</span><span class="n">ETH_Adm_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GADM"</span><span class="p">,</span><span class="w">
                             </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ETH"</span><span class="p">,</span><span class="w">
                             </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w">
              </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">,</span><span class="w">
              </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-3-1.png" alt="" /></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Elevation (meters)</span><span class="w">
</span><span class="n">ETH_elev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"alt"</span><span class="p">,</span><span class="w">
                            </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ETH"</span><span class="p">)</span><span class="w">

</span><span class="n">raster_colorPal_elev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topo.colors</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w">
                                     </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_elev</span><span class="p">),</span><span class="w">
                                     </span><span class="n">na.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Define palette</span><span class="w">
</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_elev</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_elev</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Elevation&lt;br&gt;(meters)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_elev</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_elev</span><span class="p">)</span><span class="w"> </span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-3-2.png" alt="" /></p><hr /><p>For the GADM and elevation datasets, you need to specify which country layer you want using the country ISO3 code. These are standard codes. If you are unsure, you can google it, or get a table using the following command:</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="s1">'ISO3'</span><span class="p">)</span></code></pre></figure><p>The <code class="language-plaintext highlighter-rouge">level</code> option gives you different administrative boundaries. Level 0 is country boundary, level 1 is province, level 2 district and for some countries you can get level 3 or 4. For elevation, disabling the <code class="language-plaintext highlighter-rouge">mask</code> option returns an elevation raster for the whole bounding box of the country as opposed to clipped to the country boundary:</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Ethiopia and South Sudan</span><span class="w">
</span><span class="c1"># Administrative boundaries (level 0)</span><span class="w">
</span><span class="n">SSD_Adm_0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GADM"</span><span class="p">,</span><span class="w">
                             </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SSD"</span><span class="p">,</span><span class="w">
                             </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">

</span><span class="c1"># Elevation (meters)</span><span class="w">
</span><span class="n">ETH_elev_unmasked</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"alt"</span><span class="p">,</span><span class="w">
                                     </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ETH"</span><span class="p">,</span><span class="w">
                                     </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="n">raster_colorPal_elev_unmasked</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topo.colors</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w">
                                              </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_elev_unmasked</span><span class="p">),</span><span class="w">
                                              </span><span class="n">na.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Define palette</span><span class="w">
</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="p">,</span><span class="w">
              </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
              </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
              </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_elev_unmasked</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_elev_unmasked</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Elevation&lt;br&gt;(meters)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_elev_unmasked</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_elev_unmasked</span><span class="p">)</span><span class="w"> </span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-5-1.png" alt="" /></p><p>If you are requesting WorldClim data, you also need to specify the <code class="language-plaintext highlighter-rouge">res</code> parameter which controls the resolution of the data you would like in minutes (60 minutes in 1 degree). If you are requesting the 0.5 resolution version, these are only available as tiles and you therefore also have to specify <code class="language-plaintext highlighter-rouge">lon</code> and <code class="language-plaintext highlighter-rouge">lat</code> of a point which identifies the tile you would like - e.g. this would be a point in the country of interest which you can obtain using google earth, geojson.io or a similar tool.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Precipitation from worldclim at the 2.5, 5 or 10 resolution (minutes of a degree)... no need for location specification?!?!</span><span class="w">
</span><span class="n">ETH_prec_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"worldclim"</span><span class="p">,</span><span class="w">
                            </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prec"</span><span class="p">,</span><span class="w">
                            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">

</span><span class="c1"># Precipitation from worldclim at the 0.5 resolution (minutes of a degree)... need to specifiy 'lon' and 'lat' of the tile looked for</span><span class="w">
</span><span class="n">ETH_prec_0.5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"worldclim"</span><span class="p">,</span><span class="w">
                            </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prec"</span><span class="p">,</span><span class="w">
                            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                            </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w">
                            </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span></code></pre></figure><p>Let’s take a look at the two objects with different resolutions:</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Explore objects</span><span class="w">
</span><span class="n">ETH_prec_10</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterStack 
## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 
## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 
## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ETH_prec_0.5</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterStack 
## dimensions : 3600, 3600, 12960000, 12  (nrow, ncol, ncell, nlayers)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : 30, 60, 0, 30  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## names      : prec1_27, prec2_27, prec3_27, prec4_27, prec5_27, prec6_27, prec7_27, prec8_27, prec9_27, prec10_27, prec11_27, prec12_27 
## min values :        0,        0,        0,        0,        0,        0,        0,        0,        0,         0,         0,         0 
## max values :      126,      137,      240,      697,      289,      360,      458,      457,      340,       450,       584,       184
</code></pre></div></div><p>The WorldClim data are actually raster stacks, i.e. 12 rasterLayers stacked together in a single (cube) object referring to the long term average for each month. You can extract specific months (layers of the stack) using the <code class="language-plaintext highlighter-rouge">[[]]</code> command as per an R list.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Restrict to October and plot</span><span class="w">
</span><span class="n">ETH_prec_10_Oct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ETH_prec_10</span><span class="p">[[</span><span class="m">10</span><span class="p">]]</span><span class="w">
</span><span class="n">ETH_prec_0.5_Oct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ETH_prec_0.5</span><span class="p">[[</span><span class="m">10</span><span class="p">]]</span><span class="w">


</span><span class="n">raster_colorPal_prec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topo.colors</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w">
                                     </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_prec_10_Oct</span><span class="p">),</span><span class="w">
                                     </span><span class="n">na.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Define palette</span><span class="w">

</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_prec_10_Oct</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">,</span><span class="w">
                 </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)&lt;br&gt;(10' res)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_prec_10_Oct</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"October precipitation (mm)"</span><span class="p">))</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-7-1.png" alt="" /></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="p">,</span><span class="w">
              </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
              </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
              </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">
              </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"South Sudan"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="p">,</span><span class="w">
              </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">,</span><span class="w">
              </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_Adm_1</span><span class="o">$</span><span class="n">NAME_1</span><span class="p">,</span><span class="w">
              </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
              </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w">
              </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">
              </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ethiopia"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_prec_0.5_Oct</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">,</span><span class="w">
                 </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)&lt;br&gt;(0.5' res)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_prec_0.5_Oct</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"October precipitation (mm)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ethiopia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"South Sudan"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">hideGroup</span><span class="p">(</span><span class="s2">"South Sudan"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-7-2.png" alt="" /></p><p>As you are dealing with tiles rather than country level datasets when using 0.5 resolution, in some situations you will need to obtain and merge more than 1 tile. For example, if we wanted to obtain the 0.5 resolution October precipitation for South Sudan, we would have to down load both required tiles and merge.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Precipitation from worldclim at the 0.5 resolution (minutes of a degree)... </span><span class="w">
</span><span class="c1"># This covers the left half of South Sudan (we already have the right half in the tile that covers Ethiopia)</span><span class="w">
</span><span class="n">SSD_prec_0.5_left</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">getData</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"worldclim"</span><span class="p">,</span><span class="w">
                                     </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prec"</span><span class="p">,</span><span class="w">
                                     </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                                     </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w">
                                     </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">

</span><span class="c1"># Restrict to October</span><span class="w">
</span><span class="n">SSD_prec_0.5_Oct_left</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">SSD_prec_0.5_left</span><span class="p">[[</span><span class="m">10</span><span class="p">]]</span><span class="w">

</span><span class="c1"># Merge left and right halves together</span><span class="w">
</span><span class="n">SSD_prec_0.5_Oct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_prec_0.5_Oct_left</span><span class="p">,</span><span class="w">
                                  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_prec_0.5_Oct</span><span class="p">)</span><span class="w">

</span><span class="c1"># Crop to South Sudan extent </span><span class="w">
</span><span class="n">SSD_prec_0.5_Oct_Crop_Unmasked</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">crop</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_prec_0.5_Oct</span><span class="p">,</span><span class="w">
                                               </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="p">)</span><span class="w">

</span><span class="c1"># Mask to South Sudan and plot</span><span class="w">
</span><span class="n">SSD_prec_0.5_Oct_Crop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">mask</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_prec_0.5_Oct_Crop_Unmasked</span><span class="p">,</span><span class="w">
                                      </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="p">)</span><span class="w">

</span><span class="n">raster_colorPal_prec_SSD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorNumeric</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topo.colors</span><span class="p">(</span><span class="m">64</span><span class="p">),</span><span class="w">
                                         </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">SSD_prec_0.5_Oct_Crop</span><span class="p">),</span><span class="w">
                                         </span><span class="n">na.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="c1"># Define palette</span><span class="w">

</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_prec_0.5_Oct_Crop</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec_SSD</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="p">,</span><span class="w">
              </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SSD_Adm_0</span><span class="o">$</span><span class="n">NAME_0</span><span class="p">,</span><span class="w">
              </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
              </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
              </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)&lt;br&gt;(0.5' res)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">SSD_prec_0.5_Oct_Crop</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec_SSD</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-8-1.png" alt="" /></p><hr /><h3 id="other-r-packages"><strong>Other R packages</strong></h3><p>Here are a few R packages with spatial data available:</p><ul><li>raster</li><li><a href="https://github.com/16EAGLE/getSpatialData">getSpatialData</a></li><li>rgistools</li><li>rstoolbox</li><li>sentinel2</li><li>MODIS</li></ul><hr /><h3 id="online"><strong>Online</strong></h3><p>Often times those R packages simply provide easier access to data hosted online by various research groups and can have useful additional functions to process the data. Sometimes though, you just need access to the raw data and will need to download the data from an online source (which can come in many different formats) and import in R yourself.</p><p>Download the precipitation WorldClim variable at 10’ resolution available <a href="http://worldclim.org/version2">here</a>. What you get is a folder with 12 <em>.tif</em> files, representing monthly precipitation (in mm and averaged over the 1970-2000 period), over the entire globe. As you encounter new file formats that you don’t know how to import in R, it’s good practice to scout forums. Let’s google <a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=How+to+import+.tif+files+in+R&amp;ie=UTF-8&amp;oe=UTF-8">How to import .tif files in R?</a> and find our answer on that <a href="https://stackoverflow.com/questions/16803503/reading-a-tif-file-in-r">post</a>. Fortunately, it looks like the raster function of the ‘raster’ package reads in <em>.tif</em> files.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Path to wc2 folder you just downloaded</span><span class="w">
</span><span class="n">path_to_wc2_folder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"...."</span><span class="w">

</span><span class="c1"># List files in folder downloaded</span><span class="w">
</span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">path_to_wc2_folder</span><span class="p">,</span><span class="w"> </span><span class="s2">"/wc2"</span><span class="p">))</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "readme.txt"            "wc2.0_10m_prec_01.tif"
##  [3] "wc2.0_10m_prec_02.tif" "wc2.0_10m_prec_03.tif"
##  [5] "wc2.0_10m_prec_04.tif" "wc2.0_10m_prec_05.tif"
##  [7] "wc2.0_10m_prec_06.tif" "wc2.0_10m_prec_07.tif"
##  [9] "wc2.0_10m_prec_08.tif" "wc2.0_10m_prec_09.tif"
## [11] "wc2.0_10m_prec_10.tif" "wc2.0_10m_prec_11.tif"
## [13] "wc2.0_10m_prec_12.tif"
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">path_to_wc2_folder</span><span class="p">,</span><span class="w"> </span><span class="s2">"/wc2"</span><span class="p">),</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".tif"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Restrict to .tif files</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "wc2.0_10m_prec_01.tif" "wc2.0_10m_prec_02.tif"
##  [3] "wc2.0_10m_prec_03.tif" "wc2.0_10m_prec_04.tif"
##  [5] "wc2.0_10m_prec_05.tif" "wc2.0_10m_prec_06.tif"
##  [7] "wc2.0_10m_prec_07.tif" "wc2.0_10m_prec_08.tif"
##  [9] "wc2.0_10m_prec_09.tif" "wc2.0_10m_prec_10.tif"
## [11] "wc2.0_10m_prec_11.tif" "wc2.0_10m_prec_12.tif"
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Read in October precipitation</span><span class="w">
</span><span class="n">wc2_prec_10_Oct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">path_to_wc2_folder</span><span class="p">,</span><span class="w"> </span><span class="s2">"/wc2/wc2.0_10m_prec_10.tif"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Compare to data downloaded via raster::getData()</span><span class="w">
</span><span class="n">wc2_prec_10_Oct</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/wc2/wc2.0_10m_prec_10.tif 
## names      : wc2.0_10m_prec_10 
## values     : 0, 2328  (min, max)
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ETH_prec_10_Oct</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterLayer 
## dimensions : 900, 2160, 1944000  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## source     : /Users/francoisrerolle/Desktop/wc10/prec10.bil 
## names      : prec10 
## values     : 0, 980  (min, max)
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"CartoDB.Positron"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_prec_10_Oct</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">,</span><span class="w">
                 </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"raster::getData"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wc2_prec_10_Oct</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">,</span><span class="w">
                 </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"WorldClim.com download"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"October precipitation (mm)&lt;br&gt;(10' res)"</span><span class="p">,</span><span class="w">
            </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">(</span><span class="n">ETH_prec_10_Oct</span><span class="p">),</span><span class="w">
            </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raster_colorPal_prec</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"raster::getData"</span><span class="p">,</span><span class="w"> </span><span class="s2">"WorldClim.com download"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">hideGroup</span><span class="p">(</span><span class="s2">"WorldClim.com download"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-10-1.png" alt="" /></p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Another more elegant way to read in the data downloaded online</span><span class="w">
</span><span class="n">wc2_prec_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">stack</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">path_to_wc2_folder</span><span class="p">,</span><span class="w"> </span><span class="s2">"/wc2/"</span><span class="p">,</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">path_to_wc2_folder</span><span class="p">,</span><span class="w"> </span><span class="s2">"/wc2"</span><span class="p">),</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".tif"</span><span class="p">)))</span><span class="w">
</span><span class="n">wc2_prec_10</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterStack 
## dimensions : 1080, 2160, 2332800, 12  (nrow, ncol, ncell, nlayers)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names      : wc2.0_10m_prec_01, wc2.0_10m_prec_02, wc2.0_10m_prec_03, wc2.0_10m_prec_04, wc2.0_10m_prec_05, wc2.0_10m_prec_06, wc2.0_10m_prec_07, wc2.0_10m_prec_08, wc2.0_10m_prec_09, wc2.0_10m_prec_10, wc2.0_10m_prec_11, wc2.0_10m_prec_12 
## min values :                 0,                 0,                 0,                 0,                 0,                 0,                 0,                 0,                 0,                 0,                 0,                 0 
## max values :               908,               793,               720,              1004,              2068,              2210,              2381,              1674,              1955,              2328,               718,               806
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">wc2_prec_10</span><span class="p">[[</span><span class="m">10</span><span class="p">]]</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## class      : RasterLayer 
## dimensions : 1080, 2160, 2332800  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/wc2/wc2.0_10m_prec_10.tif 
## names      : wc2.0_10m_prec_10 
## values     : 0, 2328  (min, max)
</code></pre></div></div><h3 id="other-online-resources"><strong>Other online resources</strong></h3><p>Here are a few good websites with free downloadable spatial data</p><ul><li><a href="http://worldclim.org/version2">Worldclim</a></li><li><a href="https://www.chc.ucsb.edu/data/chirps">CHIRPS</a></li><li><a href="https://earthengine.google.com">Google Earth Engine</a></li><li><a href="https://climateengine.org">Climate Engine</a></li><li><a href="https://land.copernicus.eu">Copernicus Land data</a></li><li><a href="https://map.ox.ac.uk">Malaria Atlas Project</a></li><li><a href="https://modis.gsfc.nasa.gov">MODIS</a></li></ul><hr /><hr /><h2 id="spatial-data-where-do-they-come-from">Spatial data: where do they come from?</h2><p>We often interact with climatic and environmental raster data, like the land use dataset shown below. But how are these datasets produced? The answer is via remotely sensed imagery, such as images taken by satellites, planes or drones. These data can sometimes be combined with ground data, such as data from weather stations.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Land use (# For information on land use classifications see http://due.esrin.esa.int/files/GLOBCOVER2009_Validation_Report_2.2.pdf)</span><span class="w">
</span><span class="n">ETH_land_use</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="s2">"https://github.com/HughSt/HughSt.github.io/blob/master/course_materials/week2/Lab_files/ETH_land_use.tif?raw=true"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">ETH_land_use</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-12-1.png" alt="" /></p><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/GlobalCover.png" alt="" /></p><hr /><h3 id="remote-sensing-data"><strong>Remote sensing data</strong></h3><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/NASA.png" alt="" /></p><p>Satellites orbiting around the globe carry instruments to take measurements. Just likes our eyes or cameras, the sensors onboard satellites receive a radiation that was emitted by a source of light (sun, flash, light bulb, etc…) and reflected by an object. The differences between the pre and post reflection radiations characterize properties of the reflecting object such as color for which our eyes have been optimized to perceive. You can picture the radiation as a wave signal. Speed radars and the SRTM mission act in the same way (except they also send the incident radiation) and from the difference in the 2 wave signals calculate speed and elevation respectively.</p><p>Speed, elevation, color are calculated based on the wavelengths property of the wave. Sensors onboard remote sensing satelitte mission can receive multiple waves across the spectrum.</p><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/Spectrum.png" alt="" /></p><p>For instance the satellite Landsat-8 has 11 bands (i.e wavelengths ranges) at which it measures the reflectance (fraction of incident electromagnetic power that is reflected) which we can simply see as a measure of ‘light’ intensity reflected by the earth surface.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load some Etiophia Landsat data for the year 2017 (only 7 first bands available)</span><span class="w">
</span><span class="n">Landsat_Band_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band1.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band2.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band3.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band4.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band5.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band6.tif"</span><span class="p">)</span><span class="w">
</span><span class="n">Landsat_Band_7</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">raster</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/Landsat/Landsat_2017_Band7.tif"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Stack together layers</span><span class="w">
</span><span class="n">Landsat_Band</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">stack</span><span class="p">(</span><span class="n">Landsat_Band_1</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_2</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_3</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_4</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_5</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_6</span><span class="p">,</span><span class="w">
                              </span><span class="n">Landsat_Band_7</span><span class="p">)</span><span class="w">

</span><span class="c1"># Explore the reflectance values. Assume you should normalize by 10000 to get reflectance</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">Landsat_Band</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##         Landsat_2017_Band1
## Min.                  11.0
## 1st Qu.              338.5
## Median               404.0
## 3rd Qu.              494.5
## Max.                2538.5
## NA's                   0.0
</code></pre></div></div><hr /><h3 id="how-do-you-get-from-reflectance-to-land-use-surfaces"><strong>How do you get from reflectance to land use surfaces?</strong></h3><p>First you can read some <a href="https://www.usgs.gov/faqs/what-are-best-landsat-spectral-bands-use-my-research?qt-news_science_products=0#qt-news_science_products">documentation</a> about the wavelength ranges covered by band for your satellite.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Label bands accordingly</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">Landsat_Band</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Ultra.blue'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Blue'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Green'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Red'</span><span class="p">,</span><span class="w"> </span><span class="s1">'NIR'</span><span class="p">,</span><span class="w"> </span><span class="s1">'SWIR1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'SWIR2'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot individual layers</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Landsat_Band_2</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Blue"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gray</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Landsat_Band_3</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Green"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gray</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Landsat_Band_4</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Red"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gray</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">Landsat_Band_5</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NIR"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gray</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">))</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-15-1.png" alt="" /></p><h5 id="pop-quiz-what-do-you-think-is-in-the-top-right-corner-of-our-spatial-extent"><em>Pop quiz: what do you think is in the top right corner of our spatial extent?</em></h5><p>Notice the difference in shading and range of legends between the different bands. This is because different surface features reflect the incident solar radiation differently. Each layer represent how much incident solar radiation is reflected for a particular wavelength range. For example, vegetation reflects more energy in NIR than other wavelengths and thus appears brighter. In contrast, water absorbs most of the energy in the NIR wavelength and it appears dark.</p><p>We do not gain that much information from these grey-scale plots; they are often combined into a “composite” to create more interesting plots. To make a “true (or natural) color” image, that is, something that looks like a normal photograph (vegetation in green, water blue etc), we need bands in the red, green and blue regions. For this Landsat image, band 4 (red), 3 (green), and 2 (blue) can be used. The plotRGB method can be used to combine them into a single composite. You can also supply additional arguments to plotRGB to improve the visualization (e.g. a linear stretch of the values, using stretch = “lin”).</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">raster</span><span class="o">::</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">,</span><span class="w">
                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w">
                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">
                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                </span><span class="n">stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lin"</span><span class="p">,</span><span class="w">
                </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Landsat True Color Composite"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-16-1.png" alt="" /></p><p>The true-color composite reveals much more about the landscape than the earlier gray images. Another popular image visualization method in remote sensing is known “false color” image in which NIR, red, and green bands are combined. This representation is popular as it makes it easy to see the vegetation (in red).</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">raster</span><span class="o">::</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">,</span><span class="w">
                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w">
                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w">
                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">
                </span><span class="n">stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lin"</span><span class="p">,</span><span class="w">
                </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Landsat False Color Composite"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-17-1.png" alt="" /></p><hr /><h3 id="relation-between-bands"><strong>Relation between bands</strong></h3><p>A scatterplot matrix can be helpful in exploring relationships between raster layers. This can be done with the pairs() function of the “raster” package.</p><p>Plot of reflection in the ultra-blue wavelength against reflection in the blue wavelength.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">raster</span><span class="o">::</span><span class="n">pairs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">[[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ultra-blue versus Blue"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-18-1.png" alt="" /></p><p>Plot of reflection in the red wavelength against reflection in the NIR wavelength.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">raster</span><span class="o">::</span><span class="n">pairs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">[[</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">]],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Red versus NIR"</span><span class="p">)</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-19-1.png" alt="" /></p><p>The first plot reveals high correlations between the blue wavelength regions. Because of the high correlation, we can just use one of the blue bands without losing much information. The distribution of points in second plot (between NIR and red) is unique due to its triangular shape. Vegetation reflects more in the NIR range than in the red and creates the upper corner close to NIR (y) axis. Water absorbs energy from all the bands and occupies the location close to origin. The furthest corner is created due to highly reflecting surface features like bright soil or concrete.</p><hr /><h3 id="spectral-profiles"><strong>Spectral profiles</strong></h3><p>A plot of the spectrum (all bands) for pixels representing a certain earth surface features (e.g. water) is known as a spectral profile. Such profiles demonstrate the differences in spectral properties of various earth surface features and constitute the basis for image analysis.</p><p>Let’s start by loading some training data from the region which compiles GPS coordinates of points for which we know the Land use and Land cover (LULC) class.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load the training dataset, which compiles GPS coordinates of points for which we know the Land use and Land cover (LULC) class</span><span class="w">
</span><span class="n">Training_Data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/course_materials/week5/Lab_files/LULC_Training_Tana.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1"># Explore the data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">Training_Data</span><span class="p">)</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##   Latitude Longitude LULC
## 1 11.75859  37.26399   12
## 2 11.70965  37.14431   12
## 3 11.79550  37.38545   17
## 4 11.78845  37.15329   10
## 5 11.50553  37.15888   10
## 6 11.79360  37.29655   10
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Label LULC classes</span><span class="w">
</span><span class="n">Training_Data</span><span class="o">$</span><span class="n">LULC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Training_Data</span><span class="o">$</span><span class="n">LULC</span><span class="p">,</span><span class="w">
                             </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">17</span><span class="p">),</span><span class="w">
                             </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Savanna"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Grassland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Wetland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cropland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Urban"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Water"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Frequency table of classes</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">Training_Data</span><span class="o">$</span><span class="n">LULC</span><span class="p">)</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
##   Savanna Grassland   Wetland  Cropland     Urban     Water 
##         4       481        27       328         4       156
</code></pre></div></div><p>You can now convert the data frame to a spatial object to extract reflectance values at training points. Spectral values can be extracted from any multispectral data set using extract() function of the “raster” package.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Convert data frame to a SpatialPointsDataFrame by specifying coordinates</span><span class="w">
</span><span class="n">Training_Data_DF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Training_Data</span><span class="w"> </span><span class="c1"># Save a data frame version</span><span class="w">
</span><span class="n">sp</span><span class="o">::</span><span class="n">coordinates</span><span class="p">(</span><span class="n">Training_Data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Latitude"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extract values from the reflectance images at the point locations and merge to training dataset</span><span class="w">
</span><span class="n">Training_Data_Reflectance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">LULC</span><span class="w"> </span><span class="o">=</span><span class="n">Training_Data_DF</span><span class="o">$</span><span class="n">LULC</span><span class="p">),</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">raster</span><span class="o">::</span><span class="n">extract</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Training_Data</span><span class="p">)))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">Training_Data_Reflectance</span><span class="p">)</span><span class="w"> </span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        LULC Ultra.blue Blue Green  Red  NIR SWIR1 SWIR2
## 1  Cropland        372  512   823  991 2494  2548  1620
## 2  Cropland        375  483   795 1183 2038  1886  1613
## 3     Water        603  780  1378 1111  259   171   141
## 4 Grassland        364  485   806  917 1767  1524   997
## 5 Grassland        355  437   693  765 1972  1990  1427
## 6 Grassland        407  499   759  868 2254  2161  1433
</code></pre></div></div><p>We can now compute the mean reflectance values for each class and each band and plot to obtain the spectral profiles.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Average reflectance values over LULC classes</span><span class="w">
</span><span class="n">LULC_Mean_Reflectance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stats</span><span class="o">::</span><span class="n">aggregate</span><span class="p">(</span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LULC</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Training_Data_Reflectance</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)})</span><span class="w">
</span><span class="n">LULC_Mean_Reflectance</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        LULC Ultra.blue   Blue   Green     Red     NIR   SWIR1   SWIR2
## 1   Savanna     404.00 455.25  702.12  747.62 2303.88 1639.50 1085.62
## 2 Grassland     367.07 450.39  731.63  883.92 2137.84 2044.79 1478.32
## 3   Wetland     360.65 440.81  760.96  664.87 1929.70 1099.56  586.33
## 4  Cropland     408.25 503.26  794.93 1030.95 2308.46 2169.48 1615.76
## 5     Urban     476.38 580.12  848.00  957.88 2128.75 1884.00 1393.12
## 6     Water     571.12 731.72 1313.05 1131.43  302.03  170.37  136.47
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Reshape to long format</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">LULC_Mean_Reflectance_Long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidyr</span><span class="o">::</span><span class="n">gather</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LULC_Mean_Reflectance</span><span class="p">,</span><span class="w">
                                            </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Band"</span><span class="p">,</span><span class="w">
                                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Reflectance"</span><span class="p">,</span><span class="w">
                                            </span><span class="n">...</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="s2">"LULC"</span><span class="p">,</span><span class="w">
                                            </span><span class="n">factor_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot2</span><span class="o">::</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LULC_Mean_Reflectance_Long</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Band</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Reflectance</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LULC</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LULC</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-22-1.png" alt="" /></p><p>The spectral profiles show (dis)similarity in the reflectance of different features on the earth’s surface (or above it). ‘Water’ shows relatively low reflection in all wavelengths, while all other classes have relatively high reflectance in the longer wavelengts. Remember though that while our training data is made up of 1000 points across 6 LULC classes, we have relatively few observations for ‘Savanna’, ‘Wetland’ and ‘Urban’ classes.</p><hr /><h3 id="classification"><strong>Classification</strong></h3><p>So now we have observed classes and the spectral values for each of those observations, it is possible to build a classification model. There are a number of different ways of fitting such a classifcation (sometimes called multi-nomial) model. Here we are going to use a random forest model which is a type of decision tree machine learning model. We are going to use the “randomForest” package.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">
</span><span class="n">RF_Model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="o">::</span><span class="n">randomForest</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Training_Data_Reflectance</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">8</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Training_Data_Reflectance</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">RF_Model</span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
## Call:
##  randomForest(x = Training_Data_Reflectance[, 2:8], y = Training_Data_Reflectance[,      1]) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 22.9%
## Confusion matrix:
##           Savanna Grassland Wetland Cropland Urban Water class.error
## Savanna         0         1       2        1     0     0  1.00000000
## Grassland       1       378       8       92     0     2  0.21413721
## Wetland         1        10      12        0     0     4  0.55555556
## Cropland        0        99       1      228     0     0  0.30487805
## Urban           0         2       0        2     0     0  1.00000000
## Water           0         1       2        0     0   153  0.01923077
</code></pre></div></div><p>By inspecting the output of the model, we realize it is not doing a super job. The <code class="language-plaintext highlighter-rouge">OOB estimate of error rate</code> refers to ‘out of bag’ error rate. In this context, out of bag is similar to cross-vadliation we explored as part of interpolation - i.e. how well the model is predicting data not included in the model. Again remember we only have a few observations in our training dataset. Classification of the ‘water’ class is pretty good, thanks to its particular spectral profile. Now that we have a model of the relationship between land cover and reflectance values, we can predict land cover over our entire region.</p><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">LULC_predicted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">predict</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Landsat_Band</span><span class="p">,</span><span class="w">
                                  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RF_Model</span><span class="p">,</span><span class="w">
                                  </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'text'</span><span class="p">,</span><span class="w">
                                  </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'response'</span><span class="p">,</span><span class="w">
                                  </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span></code></pre></figure><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 
  |                                                                       
  |                                                                 |   0%
  |                                                                       
  |================                                                 |  25%
  |                                                                       
  |================================                                 |  50%
  |                                                                       
  |=================================================                |  75%
  |                                                                       
  |=================================================================| 100%
## 
</code></pre></div></div><figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span><span class="n">factpal_LULC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorFactor</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">Training_Data_DF</span><span class="o">$</span><span class="n">LULC</span><span class="p">)),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">),</span><span class="w">
                            </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">Training_Data_DF</span><span class="o">$</span><span class="n">LULC</span><span class="p">))))</span><span class="w"> </span><span class="c1"># define color palette</span><span class="w">

</span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Plot</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="s2">"Esri.WorldImagery"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addRasterImage</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LULC_predicted</span><span class="p">,</span><span class="w">
                 </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factpal_LULC</span><span class="p">,</span><span class="w">
                 </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted LULC"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLegend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted LULC"</span><span class="p">,</span><span class="w">
            </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">Training_Data_DF</span><span class="o">$</span><span class="n">LULC</span><span class="p">)),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">),</span><span class="w">
            </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Savanna"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Grassland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Wetland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cropland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Urban"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Water"</span><span class="p">),</span><span class="w">
            </span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Predicted LULC"</span><span class="p">))</span></code></pre></figure><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/unnamed-chunk-24-1.png" alt="" /></p><hr /><h3 id="concluding-remarks"><strong>Concluding remarks</strong></h3><p>Now you have a sense of how remote sensing can be used to produce all sort of environmental layers. The quality of those will depend on the spatial and temporal resolutions of the sensors as well as the techniques used to process the raw data (clouds?) and model it to produce more useful layers.</p><p><img src="https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/Week_5_Spatial_Epi_files/figure-markdown_github/Hagibis.jpg" alt="" /></p><hr /><h2 id="resources">Resources</h2><p>This week borrows heavily from <a href="https://rspatial.org/rs/rs.pdf">this</a> excellent tutorial</p><h2 id="readings">Readings</h2><p>Hay SI. An overview of remote sensing and geodesy for epidemiology and public health application. Advances in parasitology. 2000 Jan 1;47:1-35.</p><p>Simoonga C, Utzinger J, Brooker S, Vounatsou P, Appleton CC, Stensgaard AS, Olsen A, Kristensen TK. Remote sensing, geographical information system and spatial analysis for schistosomiasis epidemiology and ecology in Africa. Parasitology. 2009 Nov;136(13):1683-93.</p><p>Savory DJ, Andrade-Pacheco R, Gething PW, Midekisa A, Bennett A, Sturrock HJ. Intercalibration and Gaussian process modeling of nighttime lights imagery for measuring urbanization trends in Africa 2000–2013. Remote Sensing. 2017 Jul;9(7):713.</p><p>Yang GJ, Vounatsou P, Xiao-Nong Z, Utzinger J, Tanner M. A review of geographic information system and remote sensing with applications to the epidemiology and control of schistosomiasis in China. Acta tropica. 2005 Nov 1;96(2-3):117-29.</p></article></div></main><footer class="footer"><div class="container"><nav class="social"></nav><span>&copy; 2022 Applied Spatial Data Science for Public Health. All rights reserved.</span></div></footer><script async src="/assets/js/bundle.js"></script></body></html>
